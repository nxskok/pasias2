<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>19&nbsp; Multiple regression – Problems and Solutions in Applied Statistics (2nd ed)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./regression-categorical.html" rel="next">
<link href="./simple-regression.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./multiple-regression.html"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Multiple regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Problems and Solutions in Applied Statistics (2nd ed)</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_used.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting used to R and R Studio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reading-in.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Reading in data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./making-graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Drawing graphs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-summaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data exploration</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./working-with-dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with dataframes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./one-sample-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">One-sample inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./two-sample-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Two-sample inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Power and sample size</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The sign test</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mood-median.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Mood median test</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matched-pairs-sign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Matched pairs t and sign test</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./normal-quantile.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Normal quantile plots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analysis-of-variance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Analysis of variance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Writing reports</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Learning to code</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dandruff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Treating dandruff</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidying-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Tidying data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simple-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Simple regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple-regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Multiple regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression-categorical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Regression with categorical variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dates-and-times.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Dates and times</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vector-matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Vector and matrix algebra</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">The Bootstrap</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Bayesian Statistics with Stan</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression-revisited.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Regression revisited</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Logistic regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ordinal-response.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Logistic regression with ordinal response</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nominal-response.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Logistic regression with nominal response</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Survival analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anova-revisited.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Analysis of variance revisited</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Analysis of covariance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./manova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Multivariate analysis of variance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./repeated-measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Repeated measures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discriminant-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Discriminant analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Hierarchical cluster analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kmeans-cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">K-means cluster analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Drawing maps with Leaflet</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Multidimensional Scaling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Principal Components</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Factor Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./loglin.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Frequency table analysis</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#being-satisfied-with-hospital" id="toc-being-satisfied-with-hospital" class="nav-link active" data-scroll-target="#being-satisfied-with-hospital"><span class="header-section-number">19.1</span> Being satisfied with hospital</a></li>
  <li><a href="#salaries-of-mathematicians" id="toc-salaries-of-mathematicians" class="nav-link" data-scroll-target="#salaries-of-mathematicians"><span class="header-section-number">19.2</span> Salaries of mathematicians</a></li>
  <li><a href="#predicting-gpa-of-computer-science-students" id="toc-predicting-gpa-of-computer-science-students" class="nav-link" data-scroll-target="#predicting-gpa-of-computer-science-students"><span class="header-section-number">19.3</span> Predicting GPA of computer science students</a></li>
  <li><a href="#fish-and-mercury" id="toc-fish-and-mercury" class="nav-link" data-scroll-target="#fish-and-mercury"><span class="header-section-number">19.4</span> Fish and mercury</a></li>
  <li><a href="#handling-shipments-of-chemicals" id="toc-handling-shipments-of-chemicals" class="nav-link" data-scroll-target="#handling-shipments-of-chemicals"><span class="header-section-number">19.5</span> Handling shipments of chemicals</a></li>
  <li><a href="#being-satisfied-with-hospital-1" id="toc-being-satisfied-with-hospital-1" class="nav-link" data-scroll-target="#being-satisfied-with-hospital-1"><span class="header-section-number">19.6</span> Being satisfied with hospital</a></li>
  <li><a href="#salaries-of-mathematicians-1" id="toc-salaries-of-mathematicians-1" class="nav-link" data-scroll-target="#salaries-of-mathematicians-1"><span class="header-section-number">19.7</span> Salaries of mathematicians</a></li>
  <li><a href="#predicting-gpa-of-computer-science-students-1" id="toc-predicting-gpa-of-computer-science-students-1" class="nav-link" data-scroll-target="#predicting-gpa-of-computer-science-students-1"><span class="header-section-number">19.8</span> Predicting GPA of computer science students</a></li>
  <li><a href="#fish-and-mercury-1" id="toc-fish-and-mercury-1" class="nav-link" data-scroll-target="#fish-and-mercury-1"><span class="header-section-number">19.9</span> Fish and mercury</a></li>
  <li><a href="#handling-shipments-of-chemicals-1" id="toc-handling-shipments-of-chemicals-1" class="nav-link" data-scroll-target="#handling-shipments-of-chemicals-1"><span class="header-section-number">19.10</span> Handling shipments of chemicals</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Multiple regression</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="being-satisfied-with-hospital" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="being-satisfied-with-hospital"><span class="header-section-number">19.1</span> Being satisfied with hospital</h2>
<p>A hospital administrator collects data to study the effect, if any, of a patient’s age, the severity of their illness, and their anxiety level, on the patient’s satisfaction with their hospital experience. The data, in the file <a href="http://ritsokiguess.site/datafiles/satisfaction.txt">link</a>, are for 46 patients in a survey. The columns are: patient’s satisfaction score <code>satis</code>, on a scale of 0 to 100; the patient’s <code>age</code> (in years), the <code>severity</code> of the patient’s illness (also on a 0–100 scale), and the patient’s <code>anxiety</code> score on a standard anxiety test (scale of 0–5). Higher scores mean greater satisfaction, increased severity of illness and more anxiety.</p>
<ol type="a">
<li><p>Read in the data and check that you have four columns in your data frame, one for each of your variables.</p></li>
<li><p><a name="part:scatmat">*</a> Obtain scatterplots of the response variable <code>satis</code> against each of the other variables.</p></li>
<li><p>In your scatterplots of (<a href="#part:scatmat">here</a>), which relationship appears to be the strongest one?</p></li>
<li><p><a name="part:corrmat">*</a> Create a correlation matrix for all four variables. Does your strongest trend of the previous part have the strongest correlation?</p></li>
<li><p>Run a regression predicting satisfaction from the other three variables, and display the output.</p></li>
<li><p>Does the regression fit well overall? How can you tell?</p></li>
<li><p>Test the null hypothesis that none of your explanatory variables help, against the alternative that one or more of them do. (You’ll need an appropriate P-value. Which one is it?) What do you conclude?</p></li>
<li><p>The correlation between <code>severity</code> and <code>satis</code> is not small, but in my regression I found that <code>severity</code> was nowhere near significant. Why is this? Explain briefly. </p></li>
<li><p>Carry out a backward elimination to determine which of <code>age</code>, <code>severity</code> and <code>anxiety</code> are needed to predict satisfaction. What do you get? Use <span class="math inline">\(\alpha = 0.10\)</span>.</p></li>
</ol>
</section>
<section id="salaries-of-mathematicians" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="salaries-of-mathematicians"><span class="header-section-number">19.2</span> Salaries of mathematicians</h2>
<p>A researcher in a scientific foundation wanted to evaluate the relationship between annual salaries of mathematicians and three explanatory variables:</p>
<ul>
<li><p>an index of work quality</p></li>
<li><p>number of years of experience</p></li>
<li><p>an index of publication success.</p></li>
</ul>
<p>The data can be found at <a href="http://ritsokiguess.site/datafiles/mathsal.txt">link</a>. Data from only a relatively small number of mathematicians were available.</p>
<ol type="a">
<li><p>Read in the data and check that you have a sensible number of rows and the right number of columns. (What does “a sensible number of rows” mean here?)</p></li>
<li><p>Make scatterplots of <code>salary</code> against each of the three explanatory variables. If you can, do this with <em>one</em> <code>ggplot</code>.</p></li>
<li><p>Comment briefly on the direction and strength of each relationship with <code>salary</code>.</p></li>
<li><p><a name="regone">*</a> Fit a regression predicting salary from the other three variables, and obtain a <code>summary</code> of the results.</p></li>
<li><p>How can we justify the statement “one or more of the explanatory variables helps to predict salary”? How is this consistent with the value of R-squared?</p></li>
<li><p>Would you consider removing any of the variables from this regression? Why, or why not?</p></li>
<li><p>Do you think it would be a mistake to take <em>both</em> of <code>workqual</code> and <code>pubsucc</code> out of the regression? Do a suitable test. Was your guess right?</p></li>
<li><p>Back in part (<a href="#regone">here</a>), you fitted a regression with all three explanatory variables. By making suitable plots, assess whether there is any evidence that (i) that the linear model should be a curve, (ii) that the residuals are not normally distributed, (iii) that there is “fan-out”, where the residuals are getting bigger <em>in size</em> as the fitted values get bigger? Explain briefly how you came to your conclusions in each case.</p></li>
</ol>
</section>
<section id="predicting-gpa-of-computer-science-students" class="level2" data-number="19.3">
<h2 data-number="19.3" class="anchored" data-anchor-id="predicting-gpa-of-computer-science-students"><span class="header-section-number">19.3</span> Predicting GPA of computer science students</h2>
<p>The file <a href="http://ritsokiguess.site/datafiles/gpa.txt">link</a> contains some measurements of academic achievement for a number of university students studying computer science:</p>
<ul>
<li><p>High school grade point average</p></li>
<li><p>Math SAT score</p></li>
<li><p>Verbal SAT score</p></li>
<li><p>Computer Science grade point average</p></li>
<li><p>Overall university grade point average.</p></li>
</ul>
<ol type="a">
<li><p>Read in the data and display it (or at least the first ten lines).</p></li>
<li><p><a name="part:hsu-scatter">*</a> Make a scatterplot of high school GPA against university GPA. Which variable should be the response and which explanatory? Explain briefly. Add a smooth trend to your plot.</p></li>
<li><p>Describe any relationship on your scatterplot: its direction, its strength and its shape. Justify your description briefly.</p></li>
<li><p><a name="part:highonly">*</a> Fit a linear regression for predicting university GPA from high-school GPA and display the results.</p></li>
<li><p>Two students have been admitted to university. One has a high school GPA of 3.0 and the other a high school GPA of<br>
3.5. Obtain suitable intervals that summarize the GPAs that each of these two students might obtain in university.</p></li>
<li><p><a name="part:all">*</a> Now obtain a regression predicting university GPA from high-school GPA as well as the two SAT scores. Display your results.</p></li>
<li><p>Test whether adding the two SAT scores has improved the prediction of university GPA. What do you conclude?</p></li>
<li><p>Carry out a backward elimination starting out from your model in part (<a href="#part:all">here</a>). Which model do you end up with? Is it the same model as you fit in (<a href="#part:highonly">here</a>)?</p></li>
<li><p>These students were studying computer science at university. Do you find your backward-elimination result sensible or surprising, given this? Explain briefly.</p></li>
</ol>
</section>
<section id="fish-and-mercury" class="level2" data-number="19.4">
<h2 data-number="19.4" class="anchored" data-anchor-id="fish-and-mercury"><span class="header-section-number">19.4</span> Fish and mercury</h2>
<p>Eating fish is generally healthy, but sometimes the fish is contaminated with mercury. What might affect the amount of mercury in a fish? Large-mouth bass were studied in Florida lakes to examine factors that might affect the amount of mercury contamination. 38 lakes were used for the study. Water samples were taken from each lake and analyzed. Also, samples of fish were caught in each lake and the mercury concentration in their muscle tissue was measured. The resulting data are in <a href="http://ritsokiguess.site/datafiles/mercury.txt">http://ritsokiguess.site/datafiles/mercury.txt</a>, separated by single spaces. The variables measured were as follows:</p>
<ul>
<li>standardized mercury level (parts per million in 3-year-old fish)</li>
<li>alkalinity of water (milligrams per litre)</li>
<li>calcium level of water (milligrams per litre)</li>
<li>pH of water (standard scale; see eg. <a href="https://www.usgs.gov/special-topic/water-science-school/science/ph-and-water?qt-science_center_objects=0#qt-science_center_objects">this</a>)</li>
</ul>
<ol type="a">
<li><p>Read in and display (some of) the data.</p></li>
<li><p>Plot the mercury levels against each of the explanatory variables.</p></li>
<li><p>Describe any trends (or lack thereof) that you see on your graphs.</p></li>
<li><p>Concerned by some of what you see on your plots, you consult with a fisheries scientist, who says that using the logs of <code>alkalinity</code> and <code>calcium</code> are often used in modelling this kind of data. Add columns containing the logs of these two variables to your dataframe, and run a regression predicting <code>mercury</code> from <code>ph</code> and the two new variables. Display the output from your regression.</p></li>
<li><p>What might you learn from running Box-Cox here? Explain briefly, then run it (on the same variables as your regression above) and describe what the results tell you.</p></li>
<li><p>Using the results of the Box-Cox procedure and your previous work in the question, what seems to be the most appropriate regression now? Fit it, and display the results.</p></li>
<li><p>Obtain all the standard residual plots (the ones we have seen in this course) for this model. Describe any problems you see.</p></li>
</ol>
</section>
<section id="handling-shipments-of-chemicals" class="level2" data-number="19.5">
<h2 data-number="19.5" class="anchored" data-anchor-id="handling-shipments-of-chemicals"><span class="header-section-number">19.5</span> Handling shipments of chemicals</h2>
<p>The data in <a href="http://ritsokiguess.site/datafiles/chemical-drums.txt">link</a> are on shipments of chemicals in drums that arrive at a warehouse. In order, the variables are:</p>
<ul>
<li><p>the number of drums in the shipment</p></li>
<li><p>the total weight of the shipment, in hundreds of pounds.</p></li>
<li><p>the number of minutes required to handle the shipment (response).</p></li>
</ul>
<ol type="a">
<li><p>The data set has two features: <em>no</em> column names, and data aligned in columns (that is, more than one space between data values). Read the data in, giving the columns suitable names. To do this, you may have to consult an appropriate help file, or do some searching.</p></li>
<li><p>Fit a regression predicting the number of minutes required to handle a shipment from the other two variables. Display the results.</p></li>
<li><p>Explain carefully but briefly what the slope coefficients for the two explanatory variables represent. Do their signs (positive or negative) make practical sense in the context of handling shipments of chemicals?</p></li>
<li><p>Obtain plots of residuals against fitted values, residuals against explanatory variables, and a normal quantile plot of the residuals.</p></li>
<li><p>Do you have any concerns, looking at the residual plots? Explain briefly.</p></li>
</ol>
<p>My solutions follow:</p>
</section>
<section id="being-satisfied-with-hospital-1" class="level2" data-number="19.6">
<h2 data-number="19.6" class="anchored" data-anchor-id="being-satisfied-with-hospital-1"><span class="header-section-number">19.6</span> Being satisfied with hospital</h2>
<p>A hospital administrator collects data to study the effect, if any, of a patient’s age, the severity of their illness, and their anxiety level, on the patient’s satisfaction with their hospital experience. The data, in the file <a href="http://ritsokiguess.site/datafiles/satisfaction.txt">link</a>, are for 46 patients in a survey. The columns are: patient’s satisfaction score <code>satis</code>, on a scale of 0 to 100; the patient’s <code>age</code> (in years), the <code>severity</code> of the patient’s illness (also on a 0–100 scale), and the patient’s <code>anxiety</code> score on a standard anxiety test (scale of 0–5). Higher scores mean greater satisfaction, increased severity of illness and more anxiety.</p>
<ol type="a">
<li>Read in the data and check that you have four columns in your data frame, one for each of your variables.</li>
</ol>
<p>Solution</p>
<p>This one requires a little thought first. The data values are aligned in columns, and so are the column headers. Thus, <code>read_table</code> is what we need:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/satisfaction.txt"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>satisf <span class="ot">&lt;-</span> <span class="fu">read_table</span>(my_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  satis = col_double(),
  age = col_double(),
  severity = col_double(),
  anxiety = col_double()
)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>satisf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["satis"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["severity"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["anxiety"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"48","2":"50","3":"51","4":"2.3"},{"1":"57","2":"36","3":"46","4":"2.3"},{"1":"66","2":"40","3":"48","4":"2.2"},{"1":"70","2":"41","3":"44","4":"1.8"},{"1":"89","2":"28","3":"43","4":"1.8"},{"1":"36","2":"49","3":"54","4":"2.9"},{"1":"46","2":"42","3":"50","4":"2.2"},{"1":"54","2":"45","3":"48","4":"2.4"},{"1":"26","2":"52","3":"62","4":"2.9"},{"1":"77","2":"29","3":"50","4":"2.1"},{"1":"89","2":"29","3":"48","4":"2.4"},{"1":"67","2":"43","3":"53","4":"2.4"},{"1":"47","2":"38","3":"55","4":"2.2"},{"1":"51","2":"34","3":"51","4":"2.3"},{"1":"57","2":"53","3":"54","4":"2.2"},{"1":"66","2":"36","3":"49","4":"2.0"},{"1":"79","2":"33","3":"56","4":"2.5"},{"1":"88","2":"29","3":"46","4":"1.9"},{"1":"60","2":"33","3":"49","4":"2.1"},{"1":"49","2":"55","3":"51","4":"2.4"},{"1":"77","2":"29","3":"52","4":"2.3"},{"1":"52","2":"44","3":"58","4":"2.9"},{"1":"60","2":"43","3":"50","4":"2.3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>46 rows and 4 columns: satisfaction score (response), age, severity and anxiety (explanatory).</p>
<p>There is a small question about what to call the data frame. Basically, anything other than <code>satis</code> will do, since there will be confusion if your data frame has the same name as one of its columns.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" type="a">
<li><a name="part:scatmat">*</a> Obtain scatterplots of the response variable <code>satis</code> against each of the other variables.</li>
</ol>
<p>Solution</p>
<p>The obvious way is to do these one after the other:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(satisf, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> satis)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/hospital-2-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(satisf, <span class="fu">aes</span>(<span class="at">x =</span> severity, <span class="at">y =</span> satis)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/hospital-2-2.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(satisf, <span class="fu">aes</span>(<span class="at">x =</span> anxiety, <span class="at">y =</span> satis)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/hospital-2-3.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>This is fine, but there is also a way of getting all three plots with <em>one</em> <code>ggplot</code>. This uses the <code>facet_wrap</code> trick, but to set <em>that</em> up, we have to have all the <span class="math inline">\(x\)</span>-variables in <em>one</em> column, with an extra column labelling which <span class="math inline">\(x\)</span>-variable that value was. This uses <code>pivot_longer</code>. The right way to do this is in a pipeline:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>satisf <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>satis, <span class="at">names_to=</span><span class="st">"xname"</span>, <span class="at">values_to=</span><span class="st">"x"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> satis)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>xname, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/hospital-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Steps: collect together the columns age through anxiety into one column whose values go in <code>x</code>, with names in <code>xname</code>, then plot this new <code>x</code> against satisfaction score, with a separate facet for each different <span class="math inline">\(x\)</span> (in <code>xname</code>).</p>
<p>What’s the difference between <code>facet_grid</code> and <code>facet_wrap</code>? The difference is that with <code>facet_wrap</code>, we are letting <code>ggplot</code> arrange the facets how it wants to. In this case, we didn’t care which explanatory variable went on which facet, just as long as we saw all of them somewhere. Inside <code>facet_wrap</code> there are <em>no dots</em>: a squiggle, followed by the name(s) of the variable(s) that distinguish(es) the facets.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> The only “design” decision I made here was that the facets should be arranged somehow in two columns, but I didn’t care which ones should be where.</p>
<p>In <code>facet_grid</code>, you have a variable that you want to be displayed in rows or in columns (not just in “different facets”). I’ll show you how that works here. Since I am going to draw two plots, I should save the long data frame first and re-use it, rather than calculating it twice (so that I ought now to go back and do the other one using the saved data frame, really):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>satisf <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(age<span class="sc">:</span>anxiety, <span class="at">names_to=</span><span class="st">"xname"</span>, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span><span class="st">"x"</span>) <span class="ot">-&gt;</span> satisf.long</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>satisf.long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["satis"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["xname"],"name":[2],"type":["chr"],"align":["left"]},{"label":["x"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"48","2":"age","3":"50.0"},{"1":"48","2":"severity","3":"51.0"},{"1":"48","2":"anxiety","3":"2.3"},{"1":"57","2":"age","3":"36.0"},{"1":"57","2":"severity","3":"46.0"},{"1":"57","2":"anxiety","3":"2.3"},{"1":"66","2":"age","3":"40.0"},{"1":"66","2":"severity","3":"48.0"},{"1":"66","2":"anxiety","3":"2.2"},{"1":"70","2":"age","3":"41.0"},{"1":"70","2":"severity","3":"44.0"},{"1":"70","2":"anxiety","3":"1.8"},{"1":"89","2":"age","3":"28.0"},{"1":"89","2":"severity","3":"43.0"},{"1":"89","2":"anxiety","3":"1.8"},{"1":"36","2":"age","3":"49.0"},{"1":"36","2":"severity","3":"54.0"},{"1":"36","2":"anxiety","3":"2.9"},{"1":"46","2":"age","3":"42.0"},{"1":"46","2":"severity","3":"50.0"},{"1":"46","2":"anxiety","3":"2.2"},{"1":"54","2":"age","3":"45.0"},{"1":"54","2":"severity","3":"48.0"},{"1":"54","2":"anxiety","3":"2.4"},{"1":"26","2":"age","3":"52.0"},{"1":"26","2":"severity","3":"62.0"},{"1":"26","2":"anxiety","3":"2.9"},{"1":"77","2":"age","3":"29.0"},{"1":"77","2":"severity","3":"50.0"},{"1":"77","2":"anxiety","3":"2.1"},{"1":"89","2":"age","3":"29.0"},{"1":"89","2":"severity","3":"48.0"},{"1":"89","2":"anxiety","3":"2.4"},{"1":"67","2":"age","3":"43.0"},{"1":"67","2":"severity","3":"53.0"},{"1":"67","2":"anxiety","3":"2.4"},{"1":"47","2":"age","3":"38.0"},{"1":"47","2":"severity","3":"55.0"},{"1":"47","2":"anxiety","3":"2.2"},{"1":"51","2":"age","3":"34.0"},{"1":"51","2":"severity","3":"51.0"},{"1":"51","2":"anxiety","3":"2.3"},{"1":"57","2":"age","3":"53.0"},{"1":"57","2":"severity","3":"54.0"},{"1":"57","2":"anxiety","3":"2.2"},{"1":"66","2":"age","3":"36.0"},{"1":"66","2":"severity","3":"49.0"},{"1":"66","2":"anxiety","3":"2.0"},{"1":"79","2":"age","3":"33.0"},{"1":"79","2":"severity","3":"56.0"},{"1":"79","2":"anxiety","3":"2.5"},{"1":"88","2":"age","3":"29.0"},{"1":"88","2":"severity","3":"46.0"},{"1":"88","2":"anxiety","3":"1.9"},{"1":"60","2":"age","3":"33.0"},{"1":"60","2":"severity","3":"49.0"},{"1":"60","2":"anxiety","3":"2.1"},{"1":"49","2":"age","3":"55.0"},{"1":"49","2":"severity","3":"51.0"},{"1":"49","2":"anxiety","3":"2.4"},{"1":"77","2":"age","3":"29.0"},{"1":"77","2":"severity","3":"52.0"},{"1":"77","2":"anxiety","3":"2.3"},{"1":"52","2":"age","3":"44.0"},{"1":"52","2":"severity","3":"58.0"},{"1":"52","2":"anxiety","3":"2.9"},{"1":"60","2":"age","3":"43.0"},{"1":"60","2":"severity","3":"50.0"},{"1":"60","2":"anxiety","3":"2.3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>If, at this or any stage, you get confused, the way to un-confuse yourself is to <em>fire up R Studio and do this yourself</em>. You have all the data and code you need. If you do it yourself, you can run pipes one line at a time, inspect things, and so on.</p>
<p>First, making a <em>row</em> of plots, so that <code>xname</code> is the <span class="math inline">\(x\)</span> of the facets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(satisf.long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> satis)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> xname, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/hospital-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I find these too tall and skinny to see the trends, as on the first <code>facet_wrap</code> plot.</p>
<p>And now, making a <em>column</em> of plots, with <code>xname</code> as <span class="math inline">\(y\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(satisf.long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> satis)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(xname <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/hospital-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This one looks weird because the three <span class="math inline">\(x\)</span>-variables are on different scales. The effect of the <code>scales="free"</code> is to allow the <code>satis</code> scale to vary, but the <code>x</code> scale cannot because the facets are all in a line. Compare this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(satisf.long, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> satis)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>xname, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/hospital-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This time, the <span class="math inline">\(x\)</span> scales came out different (and suitable), but I still like squarer plots better for judging relationships.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" type="a">
<li>In your scatterplots of (<a href="#part:scatmat">here</a>), which relationship appears to be the strongest one?</li>
</ol>
<p>Solution</p>
<p>All the trends appear to be downward ones, but I think <code>satis</code> and <code>age</code> is the strongest trend. The other ones look more scattered to me.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" type="a">
<li><a name="part:corrmat">*</a> Create a correlation matrix for all four variables. Does your strongest trend of the previous part have the strongest correlation?</li>
</ol>
<p>Solution</p>
<p>This is a matter of running the whole data frame through <code>cor</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(satisf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              satis        age   severity    anxiety
satis     1.0000000 -0.7736828 -0.5874444 -0.6023105
age      -0.7736828  1.0000000  0.4666091  0.4976945
severity -0.5874444  0.4666091  1.0000000  0.7945275
anxiety  -0.6023105  0.4976945  0.7945275  1.0000000</code></pre>
</div>
</div>
<p>Ignoring the correlations of variables with themselves, the correlation of <code>satisf</code> with <code>age</code>, the one I picked out, is the strongest (the most negative trend). If you picked one of the other trends as the strongest, you need to note how close it is to the maximum correlation: for example, if you picked <code>satis</code> and <code>severity</code>, that’s the second highest correlation (in size).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" type="a">
<li>Run a regression predicting satisfaction from the other three variables, and display the output.</li>
</ol>
<p>Solution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>satisf<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(satis <span class="sc">~</span> age <span class="sc">+</span> severity <span class="sc">+</span> anxiety, <span class="at">data =</span> satisf)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(satisf<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = satis ~ age + severity + anxiety, data = satisf)

Residuals:
    Min      1Q  Median      3Q     Max 
-16.954  -7.154   1.550   6.599  14.888 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 162.8759    25.7757   6.319 4.59e-06 ***
age          -1.2103     0.3015  -4.015  0.00074 ***
severity     -0.6659     0.8210  -0.811  0.42736    
anxiety      -8.6130    12.2413  -0.704  0.49021    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 10.29 on 19 degrees of freedom
Multiple R-squared:  0.6727,    Adjusted R-squared:  0.621 
F-statistic: 13.01 on 3 and 19 DF,  p-value: 7.482e-05</code></pre>
</div>
</div>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" type="a">
<li>Does the regression fit well overall? How can you tell?</li>
</ol>
<p>Solution</p>
<p>For this, look at R-squared, which is 0.682 (68.2%). This is one of those things to have an opinion about. I’d say this is good but not great. I would not call it “poor”, since there definitely <em>is</em> a relationship, even if it’s not a stupendously good one.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" type="a">
<li>Test the null hypothesis that none of your explanatory variables help, against the alternative that one or more of them do. (You’ll need an appropriate P-value. Which one is it?) What do you conclude?</li>
</ol>
<p>Solution</p>
<p>This one is the (global) <span class="math inline">\(F\)</span>-test, whose P-value is at the bottom. It translates to 0.000000000154, so this is <em>definitely</em> small, and we reject the null. Thus, one or more of <code>age</code>, <code>severity</code> and <code>anxiety</code> helps to predict satisfaction. (I would like to see this last sentence, rather than just “reject the null”.)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" type="a">
<li>The correlation between <code>severity</code> and <code>satis</code> is not small, but in my regression I found that <code>severity</code> was nowhere near significant. Why is this? Explain briefly. </li>
</ol>
<p>Solution</p>
<p>The key thing to observe is that the <span class="math inline">\(t\)</span>-test in the regression says how important a variable is <em>given the others that are already in the regression</em>, or, if you prefer, how much that variable <em>adds</em> to the regression, on top of the ones that are already there. So here, we are saying that <code>severity</code> has nothing to add, given that the regression already includes the others. (That is, high correlation and strong significance don’t always go together.) For a little more insight, look at the correlation matrix of (<a href="#part:corrmat">here</a>) again. The strongest trend with <code>satis</code> is with <code>age</code>, and indeed <code>age</code> is the one obviously significant variable in the regression. The trend of <code>severity</code> with <code>satis</code> is somewhat downward, and you might otherwise have guessed that this is strong enough to be significant. But see that <code>severity</code> <em>also</em> has a clear relationship with <code>age</code>. A patient with low severity of disease is probably also younger, and we know that younger patients are likely to be more satisfied. Thus severity has nothing (much) to add.</p>
<p>Extra 1: The multiple regression is actually doing something clever here. Just looking at the correlations, it appears that all three variables are helpful, but the regression is saying that once you have looked at <code>age</code> (“controlled for age”), severity of illness does not have an impact: the correlation of <code>severity</code> with <code>satis</code> is as big as it is almost entirely because of <code>age</code>. This gets into the domain of “partial correlation”. If you like videos, you can see <a href="https://www.youtube.com/watch?v=LF0WAVBIhNA">link</a> for this. I prefer regression, myself, since I find it clearer. <code>anxiety</code> tells a different story: this is close to significant (or <em>is</em> significant at the <span class="math inline">\(\alpha=0.10\)</span> level), so the regression is saying that <code>anxiety</code> <em>does</em> appear to have something to say about <code>satis</code> over and above <code>age</code>. This is rather odd, to my mind, since <code>anxiety</code> has only a slightly stronger correlation with <code>satis</code> and about the same with <code>age</code> as <code>severity</code> does. But the regression is telling the story to believe, because it handles all the inter-correlations, not just the ones between pairs of variables.</p>
<p>I thought it would be rather interesting to do some predictions here. Let’s predict satisfaction for all combinations of high and low age, severity and anxiety. I’ll use the quartiles for high and low.</p>
<p>The easiest way to get those is via <code>summary</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(satisf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     satis            age           severity        anxiety     
 Min.   :26.00   Min.   :28.00   Min.   :43.00   Min.   :1.800  
 1st Qu.:50.00   1st Qu.:33.00   1st Qu.:48.00   1st Qu.:2.150  
 Median :60.00   Median :40.00   Median :50.00   Median :2.300  
 Mean   :61.35   Mean   :39.61   Mean   :50.78   Mean   :2.296  
 3rd Qu.:73.50   3rd Qu.:44.50   3rd Qu.:53.50   3rd Qu.:2.400  
 Max.   :89.00   Max.   :55.00   Max.   :62.00   Max.   :2.900  </code></pre>
</div>
</div>
<p>and then use <code>datagrid</code> to make combinations for prediction:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>new <span class="ot">&lt;-</span> <span class="fu">datagrid</span>(<span class="at">model =</span> satisf<span class="fl">.1</span>, <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">33</span>, <span class="fl">44.5</span>), </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">severity =</span> <span class="fu">c</span>(<span class="dv">48</span>, <span class="fl">53.5</span>), <span class="at">anxiety =</span> <span class="fu">c</span>(<span class="fl">2.15</span>, <span class="fl">2.4</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["age"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["severity"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["anxiety"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["rowid"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"33.0","2":"48.0","3":"2.15","4":"1"},{"1":"33.0","2":"48.0","3":"2.40","4":"2"},{"1":"33.0","2":"53.5","3":"2.15","4":"3"},{"1":"33.0","2":"53.5","3":"2.40","4":"4"},{"1":"44.5","2":"48.0","3":"2.15","4":"5"},{"1":"44.5","2":"48.0","3":"2.40","4":"6"},{"1":"44.5","2":"53.5","3":"2.15","4":"7"},{"1":"44.5","2":"53.5","3":"2.40","4":"8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Eight rows for the <span class="math inline">\(2^3 = 8\)</span> combinations. Then get the predictions for these:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">predictions</span>(satisf<span class="fl">.1</span>, <span class="at">newdata =</span> new))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["rowid"],"name":[1],"type":["int"],"align":["right"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["s.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["age"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["severity"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["anxiety"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["satis"],"name":[12],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"72.45391","3":"2.844180","4":"25.47444","5":"3.785042e-143","6":"473.1154","7":"66.87942","8":"78.02840","9":"33.0","10":"48.0","11":"2.15","12":"48"},{"1":"2","2":"70.30065","3":"4.435479","4":"15.84962","5":"1.414384e-56","6":"185.5278","7":"61.60727","8":"78.99403","9":"33.0","10":"48.0","11":"2.40","12":"48"},{"1":"3","2":"68.79143","3":"4.699081","4":"14.63934","5":"1.575993e-48","6":"158.7963","7":"59.58140","8":"78.00146","9":"33.0","10":"53.5","11":"2.15","12":"48"},{"1":"4","2":"66.63817","3":"3.661656","4":"18.19892","5":"5.263703e-74","6":"243.4266","7":"59.46146","8":"73.81489","9":"33.0","10":"53.5","11":"2.40","12":"48"},{"1":"5","2":"58.53525","3":"3.370091","4":"17.36904","5":"1.415680e-67","6":"222.0677","7":"51.93000","8":"65.14051","9":"44.5","10":"48.0","11":"2.15","12":"48"},{"1":"6","2":"56.38200","3":"4.233880","4":"13.31686","5":"1.847100e-40","6":"131.9919","7":"48.08374","8":"64.68025","9":"44.5","10":"48.0","11":"2.40","12":"48"},{"1":"7","2":"54.87277","3":"4.595489","4":"11.94057","5":"7.271998e-33","6":"106.7613","7":"45.86578","8":"63.87976","9":"44.5","10":"53.5","11":"2.15","12":"48"},{"1":"8","2":"52.71951","3":"2.725615","4":"19.34225","5":"2.369247e-83","6":"274.4756","7":"47.37741","8":"58.06162","9":"44.5","10":"53.5","11":"2.40","12":"48"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Extra 2: the standard errors vary quite a bit. The smallest ones are where age, severity, and anxiety are all high or all low (the last row and the first one). This is where most of the data is, because the three explanatory variables are positively correlated with each other (if you know that one of them is high, the others will probably be high too). The other standard errors are higher because there is not much data “nearby”, and so we don’t know as much about the quality of the predictions there.</p>
<p>Extra 3: we had to copy the quartile values into the new dataframe we were making (to predict from), which ought to have caused you some concern, since there was no guarantee that we copied them correctly. It would be better to make a dataframe with just the quartiles, and feed that into <code>datagrid</code>. Here’s how we can do that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>satisf <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="sc">-</span>satis,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                   \(x) <span class="fu">quantile</span>(x, <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>)))) <span class="ot">-&gt;</span> d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["age"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["severity"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["anxiety"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"33.0","2":"48.0","3":"2.15"},{"1":"44.5","2":"53.5","3":"2.40"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>To summarize several columns at once, use <code>across</code>. This one reads “for each column that is not <code>satis</code>, work out the first and third quartiles (25th and 75th percentiles) of it. Recall that the first input to <code>quantile</code> is what to compute percentiles of, and the optional<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> second input is which percentiles to compute. Also, when <code>summarize</code> is fed a summary that is more than one number long (two quartiles, here) it will automatically be unnested longer, which happens to be exactly what we want here.</p>
<p>So now, we need to take the columns from here and feed them into <code>datagrid</code>. The way to do that is to use <code>with</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>new <span class="ot">&lt;-</span> <span class="fu">with</span>(d, <span class="fu">datagrid</span>(<span class="at">model =</span> satisf<span class="fl">.1</span>, <span class="at">age =</span> age, <span class="at">severity =</span> severity, <span class="at">anxiety =</span> anxiety))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["age"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["severity"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["anxiety"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["rowid"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"33.0","2":"48.0","3":"2.15","4":"1"},{"1":"33.0","2":"48.0","3":"2.40","4":"2"},{"1":"33.0","2":"53.5","3":"2.15","4":"3"},{"1":"33.0","2":"53.5","3":"2.40","4":"4"},{"1":"44.5","2":"48.0","3":"2.15","4":"5"},{"1":"44.5","2":"48.0","3":"2.40","4":"6"},{"1":"44.5","2":"53.5","3":"2.15","4":"7"},{"1":"44.5","2":"53.5","3":"2.40","4":"8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The clunky repetition is needed because the first (eg.) <code>age</code> in <code>age = age</code> is the name that the column in <code>new</code> is going to get, and the second <code>age</code> is the thing that supplies the values to be combined (the column of <code>d</code> called <code>age</code>). This is exactly the same <code>new</code> that we had before, and so the predictions will be exactly the same as they were before.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol type="i">
<li>Carry out a backward elimination to determine which of <code>age</code>, <code>severity</code> and <code>anxiety</code> are needed to predict satisfaction. What do you get? Use <span class="math inline">\(\alpha = 0.10\)</span>.</li>
</ol>
<p>Solution</p>
<p>This means starting with the regression containing all the explanatory variables, which is the one I called <code>satisf.1</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(satisf<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = satis ~ age + severity + anxiety, data = satisf)

Residuals:
    Min      1Q  Median      3Q     Max 
-16.954  -7.154   1.550   6.599  14.888 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 162.8759    25.7757   6.319 4.59e-06 ***
age          -1.2103     0.3015  -4.015  0.00074 ***
severity     -0.6659     0.8210  -0.811  0.42736    
anxiety      -8.6130    12.2413  -0.704  0.49021    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 10.29 on 19 degrees of freedom
Multiple R-squared:  0.6727,    Adjusted R-squared:  0.621 
F-statistic: 13.01 on 3 and 19 DF,  p-value: 7.482e-05</code></pre>
</div>
</div>
<p>Pull out the least-significant (highest P-value) variable, which here is <code>severity</code>. We already decided that this had nothing to add:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>satisf<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(satisf<span class="fl">.1</span>, . <span class="sc">~</span> . <span class="sc">-</span> severity)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(satisf<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = satis ~ age + anxiety, data = satisf)

Residuals:
    Min      1Q  Median      3Q     Max 
-17.868  -6.649   2.506   6.445  16.120 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 147.0751    16.7334   8.789 2.64e-08 ***
age          -1.2434     0.2961  -4.199 0.000442 ***
anxiety     -15.8906     8.2556  -1.925 0.068593 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 10.2 on 20 degrees of freedom
Multiple R-squared:  0.6613,    Adjusted R-squared:  0.6275 
F-statistic: 19.53 on 2 and 20 DF,  p-value: 1.985e-05</code></pre>
</div>
</div>
<p>If you like, copy and paste the first <code>lm</code>, edit it to get rid of <code>severity</code>, and run it again. But when I have a “small change” to make to a model, I like to use <code>update</code>.</p>
<p>Having taken <code>severity</code> out, <code>anxiety</code> has become significant (at <span class="math inline">\(\alpha = 0.10\)</span>). Since all of the explanatory variables are now significant, this is where we stop. If we’re predicting satisfaction, we need to know both a patient’s age and their anxiety score: being older or more anxious is associated with a <em>decrease</em> in satisfaction.</p>
<p>There is also a function <code>step</code> that will do this for you:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(satisf<span class="fl">.1</span>, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=110.84
satis ~ age + severity + anxiety

           Df Sum of Sq    RSS    AIC F value    Pr(&gt;F)    
- anxiety   1     52.41 2064.0 109.43  0.4951 0.4902110    
- severity  1     69.65 2081.2 109.62  0.6579 0.4273559    
&lt;none&gt;                  2011.6 110.84                      
- age       1   1706.67 3718.3 122.97 16.1200 0.0007404 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Step:  AIC=109.43
satis ~ age + severity

           Df Sum of Sq    RSS    AIC F value    Pr(&gt;F)    
&lt;none&gt;                  2064.0 109.43                      
- severity  1    402.78 2466.8 111.53  3.9029 0.0621629 .  
- age       1   1960.56 4024.6 122.79 18.9977 0.0003042 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = satis ~ age + severity, data = satisf)

Coefficients:
(Intercept)          age     severity  
    166.591       -1.260       -1.089  </code></pre>
</div>
</div>
<p>with the same result.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> This function doesn’t actually use P-values; instead it uses a thing called AIC. At each step, the variable with the lowest AIC comes out, and when <code>&lt;none&gt;</code> bubbles up to the top, that’s when you stop. The <code>test="F"</code> means “include an <span class="math inline">\(F\)</span>-test”, but the procedure still uses AIC (it just shows you an <span class="math inline">\(F\)</span>-test each time as well). In this case, the other variables were in the same order throughout, but they don’t have to be (in the same way that removing one variable from a multiple regression can dramatically change the P-values of the ones that remain). Here, at the first step, <code>&lt;none&gt;</code> and <code>anxiety</code> were pretty close, but when <code>severity</code> came out, taking out nothing was a <em>lot</em> better than taking out <code>anxiety</code>.</p>
<p>The <code>test="F"</code> on the end gets you the P-values. Using the <span class="math inline">\(F\)</span>-test is right for regressions; for things like logistic regression that we see later, <code>test="Chisq"</code> is the right one to use.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</section>
<section id="salaries-of-mathematicians-1" class="level2" data-number="19.7">
<h2 data-number="19.7" class="anchored" data-anchor-id="salaries-of-mathematicians-1"><span class="header-section-number">19.7</span> Salaries of mathematicians</h2>
<p>A researcher in a scientific foundation wanted to evaluate the relationship between annual salaries of mathematicians and three explanatory variables:</p>
<ul>
<li><p>an index of work quality</p></li>
<li><p>number of years of experience</p></li>
<li><p>an index of publication success.</p></li>
</ul>
<p>The data can be found at <a href="http://ritsokiguess.site/datafiles/mathsal.txt">link</a>. Data from only a relatively small number of mathematicians were available.</p>
<ol type="a">
<li>Read in the data and check that you have a sensible number of rows and the right number of columns. (What does “a sensible number of rows” mean here?)</li>
</ol>
<p>Solution</p>
<p>There are aligned columns. Thus <code>read_table</code> is what you need.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/mathsal.txt"</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>salaries <span class="ot">&lt;-</span> <span class="fu">read_table</span>(my_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  salary = col_double(),
  workqual = col_double(),
  experience = col_double(),
  pubsucc = col_double()
)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>salaries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["salary"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["workqual"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["experience"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["pubsucc"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"33.2","2":"3.5","3":"9","4":"6.1"},{"1":"40.3","2":"5.3","3":"20","4":"6.4"},{"1":"38.7","2":"5.1","3":"18","4":"7.4"},{"1":"46.8","2":"5.8","3":"33","4":"6.7"},{"1":"41.4","2":"4.2","3":"31","4":"7.5"},{"1":"37.5","2":"6.0","3":"13","4":"5.9"},{"1":"39.0","2":"6.8","3":"25","4":"6.0"},{"1":"40.7","2":"5.5","3":"30","4":"4.0"},{"1":"30.1","2":"3.1","3":"5","4":"5.8"},{"1":"52.9","2":"7.2","3":"47","4":"8.3"},{"1":"38.2","2":"4.5","3":"25","4":"5.0"},{"1":"31.8","2":"4.9","3":"11","4":"6.4"},{"1":"43.3","2":"8.0","3":"23","4":"7.6"},{"1":"44.1","2":"6.5","3":"35","4":"7.0"},{"1":"42.8","2":"6.6","3":"39","4":"5.0"},{"1":"33.6","2":"3.7","3":"21","4":"4.4"},{"1":"34.2","2":"6.2","3":"7","4":"5.5"},{"1":"48.0","2":"7.0","3":"40","4":"7.0"},{"1":"38.0","2":"4.0","3":"35","4":"6.0"},{"1":"35.9","2":"4.5","3":"23","4":"3.5"},{"1":"40.4","2":"5.9","3":"33","4":"4.9"},{"1":"36.8","2":"5.6","3":"27","4":"4.3"},{"1":"45.2","2":"4.8","3":"34","4":"8.0"},{"1":"35.1","2":"3.9","3":"15","4":"5.0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>24 observations (“only a relatively small number”) and 4 columns, one for the response and one each for the explanatory variables.</p>
<p>Or, if you like,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(salaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24  4</code></pre>
</div>
</div>
<p>for the second part: 24 rows and 4 columns again. I note, with only 24 observations, that we don’t really have enough data to investigate the effects of three explanatory variables, but we’ll do the best we can. If the pattern, whatever it is, is clear enough, we should be OK.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" type="a">
<li>Make scatterplots of <code>salary</code> against each of the three explanatory variables. If you can, do this with <em>one</em> <code>ggplot</code>.</li>
</ol>
<p>Solution</p>
<p>The obvious way to do this is as three separate scatterplots, and that will definitely work. But you can do it in one go if you think about facets, and about having all the <span class="math inline">\(x\)</span>-values in one column (and the names of the <span class="math inline">\(x\)</span>-variables in another column):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>salaries <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>salary, <span class="at">names_to=</span><span class="st">"xname"</span>, <span class="at">values_to=</span><span class="st">"x"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> salary)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>xname, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/ivybridge-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you don’t see how that works, run it yourself, one line at a time.</p>
<p>I was thinking ahead a bit while I was coding that: I wanted the three plots to come out about square, and I wanted the plots to have their own scales. The last thing in the <code>facet_wrap</code> does the latter, and arranging the plots in two columns (thinking of the plots as a set of four with one missing) gets them more or less square.</p>
<p>If you don’t think of those, try it without, and then fix up what you don’t like.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" type="a">
<li>Comment briefly on the direction and strength of each relationship with <code>salary</code>.</li>
</ol>
<p>Solution</p>
<p>To my mind, all of the three relationships are going uphill (that’s the “direction” part). <code>experience</code> is the strongest, and <code>pubsucc</code> looks the weakest (that’s the “strength” part). If you want to say there is no relationship with <code>pubsucc</code>, that’s fine too. This is a judgement call. Note that all the relationships are more or less linear (no obvious curves here). We could also investigate the relationships among the explanatory variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(salaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              salary  workqual experience   pubsucc
salary     1.0000000 0.6670958  0.8585582 0.5581960
workqual   0.6670958 1.0000000  0.4669511 0.3227612
experience 0.8585582 0.4669511  1.0000000 0.2537530
pubsucc    0.5581960 0.3227612  0.2537530 1.0000000</code></pre>
</div>
</div>
<p>Mentally cut off the first row and column (<code>salary</code> is the response). None of the remaining correlations are all that high, so we ought not to have any multicollinearity problems.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" type="a">
<li><a name="regone">*</a> Fit a regression predicting salary from the other three variables, and obtain a <code>summary</code> of the results.</li>
</ol>
<p>Solution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>salaries<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> workqual <span class="sc">+</span> experience <span class="sc">+</span> pubsucc, <span class="at">data =</span> salaries)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(salaries<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ workqual + experience + pubsucc, data = salaries)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.2463 -0.9593  0.0377  1.1995  3.3089 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 17.84693    2.00188   8.915 2.10e-08 ***
workqual     1.10313    0.32957   3.347 0.003209 ** 
experience   0.32152    0.03711   8.664 3.33e-08 ***
pubsucc      1.28894    0.29848   4.318 0.000334 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.753 on 20 degrees of freedom
Multiple R-squared:  0.9109,    Adjusted R-squared:  0.8975 
F-statistic: 68.12 on 3 and 20 DF,  p-value: 1.124e-10</code></pre>
</div>
</div>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" type="a">
<li>How can we justify the statement “one or more of the explanatory variables helps to predict salary”? How is this consistent with the value of R-squared?</li>
</ol>
<p>Solution</p>
<p>“One or more of the explanatory variables helps” is an invitation to consider the (global) <span class="math inline">\(F\)</span>-test for the whole regression. This has the very small P-value of <span class="math inline">\(1.124\times
10^{-10}\)</span> (from the bottom line of the output): very small, so one or more of the explanatory variables <em>does</em> help, and the statement is correct. The idea that something helps to predict salary suggests (especially with such a small number of observations) that we should have a high R-squared. In this case, R-squared is 0.9109, which is indeed high.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" type="a">
<li>Would you consider removing any of the variables from this regression? Why, or why not?</li>
</ol>
<p>Solution</p>
<p>Look at the P-values attached to each variable. These are all very small: 0.003, 0.00000003 and 0.0003, way smaller than 0.05. So it would be a mistake to take any, even one, of the variables out: doing so would make the regression much worse. If you need convincing of that, see what happens when we take the variable with the highest P-value out — this is <code>workqual</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>salaries<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> experience <span class="sc">+</span> pubsucc, <span class="at">data =</span> salaries)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(salaries<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ experience + pubsucc, data = salaries)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.2723 -0.7865 -0.3983  1.7277  3.2060 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 21.02546    2.14819   9.788 2.82e-09 ***
experience   0.37376    0.04104   9.107 9.70e-09 ***
pubsucc      1.52753    0.35331   4.324    3e-04 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.137 on 21 degrees of freedom
Multiple R-squared:  0.8609,    Adjusted R-squared:  0.8477 
F-statistic:    65 on 2 and 21 DF,  p-value: 1.01e-09</code></pre>
</div>
</div>
<p>R-squared has gone down from 91% to 86%: maybe not so much in the grand scheme of things, but it is noticeably less. Perhaps better, since we are comparing models with different numbers of explanatory variables, is to compare the <em>adjusted</em> R-squared: this has gone down from 90% to 85%. The fact that this has gone down <em>at all</em> is enough to say that taking out <code>workqual</code> was a mistake.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>Another way of seeing whether a variable has anything to add in a regression containing the others is a <strong>partial regression plot</strong>. We take the residuals from <code>salaries.2</code> above and plot them against the variable we removed, namely <code>workqual</code>.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> If <code>workqual</code> has nothing to add, there will be no pattern; if it <em>does</em> have something to add, there will be a trend. Like this. I use <code>augment</code> from <code>broom</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>salaries<span class="fl">.2</span> <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(salaries) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> workqual, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/dartington-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is a mostly straight upward trend. So we need to add a linear term in <code>workqual</code> to the regression.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" type="a">
<li>Do you think it would be a mistake to take <em>both</em> of <code>workqual</code> and <code>pubsucc</code> out of the regression? Do a suitable test. Was your guess right?</li>
</ol>
<p>Solution</p>
<p>I think it would be a big mistake. Taking even one of these variables out of the regression is a bad idea (from the <span class="math inline">\(t\)</span>-tests), so taking out more than one would be a <em>really</em> bad idea. To perform a test, fit the model without these two explanatory variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>salaries<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> experience, <span class="at">data =</span> salaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and then use <code>anova</code> to compare the two regressions, smaller model first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(salaries<span class="fl">.3</span>, salaries<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Res.Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["RSS"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Sum of Sq"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["F"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Pr(>F)"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"22","2":"181.1912","3":"NA","4":"NA","5":"NA","6":"NA","_rn_":"1"},{"1":"20","2":"61.4430","3":"2","4":"119.7482","5":"19.48931","6":"2.010732e-05","_rn_":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The P-value is extremely small, so the bigger model is definitely better than the smaller one: we really do need all three variables. Which is what we guessed.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" type="a">
<li>Back in part (<a href="#regone">here</a>), you fitted a regression with all three explanatory variables. By making suitable plots, assess whether there is any evidence that (i) that the linear model should be a curve, (ii) that the residuals are not normally distributed, (iii) that there is “fan-out”, where the residuals are getting bigger <em>in size</em> as the fitted values get bigger? Explain briefly how you came to your conclusions in each case.</li>
</ol>
<p>Solution</p>
<p>I intended that (i) should just be a matter of looking at residuals vs.&nbsp;fitted values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(salaries<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/mathsal-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There is no appreciable pattern on here, so no evidence of a curve (or apparently of any other problems).</p>
<p>Extra: you might read this that we should check residuals against the <span class="math inline">\(x\)</span>-variables as well, which is a similar trick to the above one for plotting response against each of the explanatories. There is one step first, though: use <code>augment</code> from <code>broom</code> first to get a dataframe with the original <span class="math inline">\(x\)</span>-variables <em>and</em> the residuals in it. The following thus looks rather complicated, and if it confuses you, run the code a piece at a time to see what it’s doing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>salaries<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(salaries) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(workqual<span class="sc">:</span>pubsucc, <span class="at">names_to=</span><span class="st">"xname"</span>, <span class="at">values_to=</span><span class="st">"x"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>xname, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/mathsal-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These three residual plots are also pretty much textbook random, so no problems here either.</p>
<p>For (ii), look at a normal quantile plot of the residuals, which is not as difficult as the plot I just did:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(salaries<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">sample =</span> .resid)) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/mathsal-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>That is really pretty good. Maybe the <em>second</em> smallest point is a bit far off the line, but otherwise there’s nothing to worry about. A quick place to look for problems is the extreme observations, and the largest and smallest residuals are almost exactly the size we’d expect them to be.</p>
<p>Our graph for assessing fan-in or fan-out is to plot the <em>absolute</em> values of the residuals against the fitted values. The plot from (i) suggests that we won’t have any problems here, but to investigate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(salaries<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> <span class="fu">abs</span>(.resid))) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/mathsal-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is pretty nearly straight across. You might think it increases a bit at the beginning, but most of the evidence for that comes from the one observation with fitted value near 30 that happens to have a residual near zero. Conclusions based on one observation are not to be trusted! In summary, I’m happy with this linear multiple regression, and I don’t see any need to do anything more with it. I am, however, willing to have some sympathy with opinions that differ from mine, if they are supported by those graphs above.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</section>
<section id="predicting-gpa-of-computer-science-students-1" class="level2" data-number="19.8">
<h2 data-number="19.8" class="anchored" data-anchor-id="predicting-gpa-of-computer-science-students-1"><span class="header-section-number">19.8</span> Predicting GPA of computer science students</h2>
<p>The file <a href="http://ritsokiguess.site/datafiles/gpa.txt">link</a> contains some measurements of academic achievement for a number of university students studying computer science:</p>
<ul>
<li><p>High school grade point average</p></li>
<li><p>Math SAT score</p></li>
<li><p>Verbal SAT score</p></li>
<li><p>Computer Science grade point average</p></li>
<li><p>Overall university grade point average.</p></li>
</ul>
<ol type="a">
<li>Read in the data and display it (or at least the first ten lines).</li>
</ol>
<p>Solution</p>
<p>The usual:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/gpa.txt"</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>gpa <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 105 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
dbl (5): high_GPA, math_SAT, verb_SAT, comp_GPA, univ_GPA

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>gpa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["high_GPA"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["math_SAT"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["verb_SAT"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["comp_GPA"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["univ_GPA"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"3.45","2":"643","3":"589","4":"3.76","5":"3.52"},{"1":"2.78","2":"558","3":"512","4":"2.87","5":"2.91"},{"1":"2.52","2":"583","3":"503","4":"2.54","5":"2.40"},{"1":"3.67","2":"685","3":"602","4":"3.83","5":"3.47"},{"1":"3.24","2":"592","3":"538","4":"3.29","5":"3.47"},{"1":"2.10","2":"562","3":"486","4":"2.64","5":"2.37"},{"1":"2.82","2":"573","3":"548","4":"2.86","5":"2.40"},{"1":"2.36","2":"559","3":"536","4":"2.03","5":"2.24"},{"1":"2.42","2":"552","3":"583","4":"2.81","5":"3.02"},{"1":"3.51","2":"617","3":"591","4":"3.41","5":"3.32"},{"1":"3.48","2":"684","3":"649","4":"3.61","5":"3.59"},{"1":"2.14","2":"568","3":"592","4":"2.48","5":"2.54"},{"1":"2.59","2":"604","3":"582","4":"3.21","5":"3.19"},{"1":"3.46","2":"619","3":"624","4":"3.52","5":"3.71"},{"1":"3.51","2":"642","3":"619","4":"3.41","5":"3.58"},{"1":"3.68","2":"683","3":"642","4":"3.52","5":"3.40"},{"1":"3.91","2":"703","3":"684","4":"3.84","5":"3.73"},{"1":"3.72","2":"712","3":"652","4":"3.64","5":"3.49"},{"1":"2.15","2":"564","3":"501","4":"2.14","5":"2.25"},{"1":"2.48","2":"557","3":"549","4":"2.21","5":"2.37"},{"1":"3.09","2":"591","3":"584","4":"3.17","5":"3.29"},{"1":"2.71","2":"599","3":"562","4":"3.01","5":"3.19"},{"1":"2.46","2":"607","3":"619","4":"3.17","5":"3.28"},{"1":"3.32","2":"619","3":"558","4":"3.01","5":"3.37"},{"1":"3.61","2":"700","3":"721","4":"3.72","5":"3.61"},{"1":"3.82","2":"718","3":"732","4":"3.78","5":"3.81"},{"1":"2.64","2":"580","3":"538","4":"2.51","5":"2.40"},{"1":"2.19","2":"562","3":"507","4":"2.10","5":"2.21"},{"1":"3.34","2":"683","3":"648","4":"3.21","5":"3.58"},{"1":"3.48","2":"717","3":"724","4":"3.68","5":"3.51"},{"1":"3.56","2":"701","3":"714","4":"3.48","5":"3.62"},{"1":"3.81","2":"691","3":"684","4":"3.71","5":"3.60"},{"1":"3.92","2":"714","3":"706","4":"3.81","5":"3.65"},{"1":"4.00","2":"689","3":"673","4":"3.84","5":"3.76"},{"1":"2.52","2":"554","3":"507","4":"2.09","5":"2.27"},{"1":"2.71","2":"564","3":"543","4":"2.17","5":"2.35"},{"1":"3.15","2":"668","3":"604","4":"2.98","5":"3.17"},{"1":"3.22","2":"691","3":"662","4":"3.28","5":"3.47"},{"1":"2.29","2":"573","3":"591","4":"2.74","5":"3.00"},{"1":"2.03","2":"568","3":"517","4":"2.19","5":"2.74"},{"1":"3.14","2":"607","3":"624","4":"3.28","5":"3.37"},{"1":"3.52","2":"651","3":"683","4":"3.68","5":"3.54"},{"1":"2.91","2":"604","3":"583","4":"3.17","5":"3.28"},{"1":"2.83","2":"560","3":"542","4":"3.17","5":"3.39"},{"1":"2.65","2":"604","3":"617","4":"3.31","5":"3.28"},{"1":"2.41","2":"574","3":"548","4":"3.07","5":"3.19"},{"1":"2.54","2":"564","3":"500","4":"2.38","5":"2.52"},{"1":"2.66","2":"607","3":"528","4":"2.94","5":"3.08"},{"1":"3.21","2":"619","3":"573","4":"2.84","5":"3.01"},{"1":"3.34","2":"647","3":"608","4":"3.17","5":"3.42"},{"1":"3.68","2":"651","3":"683","4":"3.72","5":"3.60"},{"1":"2.84","2":"571","3":"543","4":"2.17","5":"2.40"},{"1":"2.74","2":"583","3":"510","4":"2.42","5":"2.83"},{"1":"2.71","2":"554","3":"538","4":"2.49","5":"2.38"},{"1":"2.24","2":"568","3":"519","4":"3.38","5":"3.21"},{"1":"2.48","2":"574","3":"602","4":"2.07","5":"2.24"},{"1":"3.14","2":"605","3":"619","4":"3.22","5":"3.40"},{"1":"2.83","2":"591","3":"584","4":"2.71","5":"3.07"},{"1":"3.44","2":"642","3":"608","4":"3.31","5":"3.52"},{"1":"2.89","2":"608","3":"573","4":"3.28","5":"3.47"},{"1":"2.67","2":"574","3":"538","4":"3.19","5":"3.08"},{"1":"3.24","2":"643","3":"607","4":"3.24","5":"3.38"},{"1":"3.29","2":"608","3":"649","4":"3.53","5":"3.41"},{"1":"3.87","2":"709","3":"688","4":"3.72","5":"3.64"},{"1":"3.94","2":"691","3":"645","4":"3.98","5":"3.71"},{"1":"3.42","2":"667","3":"583","4":"3.09","5":"3.01"},{"1":"3.52","2":"656","3":"609","4":"3.42","5":"3.37"},{"1":"2.24","2":"554","3":"542","4":"2.07","5":"2.34"},{"1":"3.29","2":"692","3":"563","4":"3.17","5":"3.29"},{"1":"3.41","2":"684","3":"672","4":"3.51","5":"3.40"},{"1":"3.56","2":"717","3":"649","4":"3.49","5":"3.38"},{"1":"3.61","2":"712","3":"708","4":"3.51","5":"3.28"},{"1":"3.28","2":"641","3":"608","4":"3.40","5":"3.31"},{"1":"3.21","2":"675","3":"632","4":"3.38","5":"3.42"},{"1":"3.48","2":"692","3":"698","4":"3.54","5":"3.39"},{"1":"3.62","2":"684","3":"609","4":"3.48","5":"3.51"},{"1":"2.92","2":"564","3":"591","4":"3.09","5":"3.17"},{"1":"2.81","2":"554","3":"509","4":"3.14","5":"3.20"},{"1":"3.11","2":"685","3":"694","4":"3.28","5":"3.41"},{"1":"3.28","2":"671","3":"609","4":"3.41","5":"3.29"},{"1":"2.70","2":"571","3":"503","4":"3.02","5":"3.17"},{"1":"2.62","2":"582","3":"591","4":"2.97","5":"3.12"},{"1":"3.72","2":"621","3":"589","4":"4.00","5":"3.71"},{"1":"3.42","2":"651","3":"642","4":"3.34","5":"3.50"},{"1":"3.51","2":"673","3":"681","4":"3.28","5":"3.34"},{"1":"3.28","2":"651","3":"640","4":"3.32","5":"3.48"},{"1":"3.42","2":"672","3":"607","4":"3.51","5":"3.44"},{"1":"3.90","2":"591","3":"587","4":"3.68","5":"3.59"},{"1":"3.12","2":"582","3":"612","4":"3.07","5":"3.28"},{"1":"2.83","2":"609","3":"555","4":"2.78","5":"3.00"},{"1":"2.09","2":"554","3":"480","4":"3.68","5":"3.42"},{"1":"3.17","2":"612","3":"590","4":"3.30","5":"3.41"},{"1":"3.28","2":"628","3":"580","4":"3.34","5":"3.49"},{"1":"3.02","2":"567","3":"602","4":"3.17","5":"3.28"},{"1":"3.42","2":"619","3":"623","4":"3.07","5":"3.17"},{"1":"3.06","2":"691","3":"683","4":"3.19","5":"3.24"},{"1":"2.76","2":"564","3":"549","4":"2.15","5":"2.34"},{"1":"3.19","2":"650","3":"684","4":"3.11","5":"3.28"},{"1":"2.23","2":"551","3":"554","4":"2.17","5":"2.29"},{"1":"2.48","2":"568","3":"541","4":"2.14","5":"2.08"},{"1":"3.76","2":"605","3":"590","4":"3.74","5":"3.64"},{"1":"3.49","2":"692","3":"683","4":"3.27","5":"3.42"},{"1":"3.07","2":"680","3":"692","4":"3.19","5":"3.25"},{"1":"2.19","2":"617","3":"503","4":"2.98","5":"2.76"},{"1":"3.46","2":"516","3":"528","4":"3.28","5":"3.41"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Two SAT scores and three GPAs, as promised.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" type="a">
<li><a name="part:hsu-scatter">*</a> Make a scatterplot of high school GPA against university GPA. Which variable should be the response and which explanatory? Explain briefly. Add a smooth trend to your plot.</li>
</ol>
<p>Solution</p>
<p>High school comes before university, so high school should be explanatory and university should be the response. (High school grades are used as an admission criterion to university, so we would hope they would have some predictive value.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gpa, <span class="fu">aes</span>(<span class="at">x =</span> high_GPA, <span class="at">y =</span> univ_GPA)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/gpa-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" type="a">
<li>Describe any relationship on your scatterplot: its direction, its strength and its shape. Justify your description briefly.</li>
</ol>
<p>Solution</p>
<p>Taking these points one at a time:</p>
<ul>
<li><p>direction: upward (a higher high-school GPA generally goes with a higher university GPA as well. Or you can say that the lowest high-school GPAs go with the lowest university GPAs, and high with high, at least most of the time).</p></li>
<li><p>strength: something like moderately strong, since while the trend is upward, there is quite a lot of scatter. (This is a judgement call: something that indicates that you are basing your description on something reasonable is fine.)</p></li>
<li><p>shape: I’d call this “approximately linear” since there is no clear curve here. The smooth trend wiggles a bit, but not enough to make me doubt a straight line.</p></li>
</ul>
<p>Looking ahead, I also notice that when high-school GPA is high, university GPA is also consistently high, but when high-school GPA is low, the university GPA is sometimes low and sometimes high, a lot more variable. (This suggests problems with fan-in later.) In a practical sense, what this seems to show is that people who do well at university usually did well in high-school as well, but sometimes their high-school grades were not that good. This is especially true for people with university GPAs around 3.25.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" type="a">
<li><a name="part:highonly">*</a> Fit a linear regression for predicting university GPA from high-school GPA and display the results.</li>
</ol>
<p>Solution</p>
<p>Just this, therefore:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>gpa<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(univ_GPA <span class="sc">~</span> high_GPA, <span class="at">data =</span> gpa)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gpa<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = univ_GPA ~ high_GPA, data = gpa)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.69040 -0.11922  0.03274  0.17397  0.91278 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.09682    0.16663   6.583 1.98e-09 ***
high_GPA     0.67483    0.05342  12.632  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2814 on 103 degrees of freedom
Multiple R-squared:  0.6077,    Adjusted R-squared:  0.6039 
F-statistic: 159.6 on 1 and 103 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Extra: this question goes on too long, so I didn’t ask you to look at the residuals from this model, but my comments earlier suggested that we might have had some problems with fanning-in (the variability of predictions getting less as the high-school GPA increases). In case you are interested, I’ll look at this here. First, residuals against fitted values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gpa<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/gpa-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Is that evidence of a trend in the residuals? Dunno. I’m inclined to call this an “inconsequential wiggle” and say it’s OK. Note that the grey envelope includes zero all the way across.</p>
<p>Normal quantile plot of residuals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gpa<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">sample =</span> .resid)) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/gpa-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A somewhat long-tailed distribution: compared to a normal distribution, the residuals are a bit too big in size, both on the positive and negative end.</p>
<p>The problem I was really worried about was the potential of fanning-in, which we can assess by looking at the absolute residuals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gpa<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> <span class="fu">abs</span>(.resid))) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/gpa-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>That is definitely a downward trend in the size of the residuals, and I think I was right to be worried before. The residuals should be of similar size all the way across.</p>
<p>The usual problem of this kind is fanning-<em>out</em>, where the residuals get <em>bigger</em> in size as the fitted values increase. The bigger values equals more spread is the kind of thing that a transformation like taking logs will handle: the bigger values are all brought downwards, so they will be both smaller and less variable than they were. This one, though, goes the other way, so the only kind of transformation that might help is one at the other end of the scale (think of the Box-Cox lambda scale), something like maybe reciprocal, <span class="math inline">\(\lambda=-1\)</span> maybe.</p>
<p>The other thought I had was that there is this kind of break around a high-school GPA of 3 (go back to the scatterplot of (<a href="#part:hsu-scatter">here</a>)): when the high-school GPA is higher than 3, the university GPA is very consistent (and shows a clear upward trend), but when the high-school GPA is less than 3, the university GPA is very variable and there doesn’t seem to be any trend at all. So maybe two separate analyses would be the way to go.</p>
<p>All right, how does Box-Cox work out here, if at all?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxcox</span>(univ_GPA <span class="sc">~</span> high_GPA, <span class="at">data =</span> gpa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/gpa-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It doesn’t. All right, that answers <em>that</em> question.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" type="a">
<li>Two students have been admitted to university. One has a high school GPA of 3.0 and the other a high school GPA of<br>
3.5. Obtain suitable intervals that summarize the GPAs that each of these two students might obtain in university.</li>
</ol>
<p>Solution</p>
<p>Since we are talking about individual students, rather than the mean of <em>all</em> students with these GPAs, prediction intervals are called for. The first step is to make a data frame to predict from. This has to contain columns for all the explanatory variables, just <code>high_GPA</code> in this case:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>new <span class="ot">&lt;-</span> <span class="fu">datagrid</span>(<span class="at">model =</span> gpa<span class="fl">.1</span>, <span class="at">high_GPA =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="fl">3.5</span>))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["high_GPA"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["rowid"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"3.0","2":"1"},{"1":"3.5","2":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In general, the advantage to doing it this way is that you also get representative values for any other explanatory variables (means for quantitative ones, the most common category for categorical ones). But in this case, the dataframe has just one column with two values in it, so any other way to create this dataframe is equally good, and, you might say, easier, like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>gpa.new <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">high_GPA =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="fl">3.5</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>gpa.new</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["high_GPA"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"3.0"},{"1":"3.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The next thing to consider is whether you want a confidence interval for the mean response (the kind of thing <code>predictions</code> gives you), or a prediction interval for an individual response. In this case, it’s the prediction interval, because we want to infer how these individual students will fare. To get this, you need the old-fashioned <code>predict</code> rather than <code>predictions</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(gpa<span class="fl">.1</span>, gpa.new, <span class="at">interval =</span> <span class="st">"p"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 3.121313 2.560424 3.682202
2 3.458728 2.896105 4.021351</code></pre>
</div>
</div>
<p>and display that side by side with the values it was predicted from:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(gpa.new, preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["high_GPA"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["fit"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lwr"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["upr"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"3.0","2":"3.121313","3":"2.560424","4":"3.682202","_rn_":"1"},{"1":"3.5","2":"3.458728","3":"2.896105","4":"4.021351","_rn_":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>or this way, if you like it better:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(preds) <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(gpa.new) <span class="sc">%&gt;%</span> <span class="fu">select</span>(high_GPA, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["high_GPA"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["fit"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lwr"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["upr"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"3.0","2":"3.121313","3":"2.560424","4":"3.682202"},{"1":"3.5","2":"3.458728","3":"2.896105","4":"4.021351"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Thus the predicted university GPA for the student with high school GPA 3.0 is between 2.6 and 3.7, and for the student with high school GPA 3.5 is between 2.9 and 4.0. (I think this is a good number of decimals to give, but in any case, you should actually <em>say</em> what the intervals are.)</p>
<p>Extra: I observe that these intervals are almost exactly the same length. This surprises me a bit, since I would have said that 3.0 is close to the average high-school GPA and 3.5 is noticeably higher. If that’s the case, the prediction interval for 3.5 should be longer (since there is less “nearby data”). Was I right about that?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>gpa <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">mean</span>(high_GPA),</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">med =</span> <span class="fu">median</span>(high_GPA),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">q1 =</span> <span class="fu">quantile</span>(high_GPA, <span class="fl">0.25</span>),</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">q3 =</span> <span class="fu">quantile</span>(high_GPA, <span class="fl">0.75</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["med"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["q1"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["q3"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"3.076381","2":"3.17","3":"2.67","4":"3.48"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>More or less: the mean is close to 3, and 3.5 is close to the third quartile. So the thing about the length of the prediction interval is a bit of a mystery. Maybe it works better for the confidence interval for the mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">predictions</span>(gpa<span class="fl">.1</span>, <span class="at">newdata =</span> new))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["rowid"],"name":[1],"type":["int"],"align":["right"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["s.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["high_GPA"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["univ_GPA"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"3.121313","3":"0.02776760","4":"112.40845","5":"0","6":"Inf","7":"3.066889","8":"3.175736","9":"3.0","10":"3.52"},{"1":"2","2":"3.458728","3":"0.03558848","4":"97.18672","5":"0","6":"Inf","7":"3.388976","8":"3.528480","9":"3.5","10":"3.52"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>These intervals are a lot shorter, since we are talking about <em>all</em> students with the high-school GPAs in question, and we therefore no longer have to worry about variation from student to student (which is considerable). But my supposition about length is now correct: the interval for 3.5, which is further from the mean, is a little longer than the interval for 3.0. Thinking about it, it seems that the individual-to-individual variation, which is large, is dominating things for our prediction interval above.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" type="a">
<li><a name="part:all">*</a> Now obtain a regression predicting university GPA from high-school GPA as well as the two SAT scores. Display your results.</li>
</ol>
<p>Solution</p>
<p>Create a new regression with all the explanatory variables you want in it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>gpa<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(univ_GPA <span class="sc">~</span> high_GPA <span class="sc">+</span> math_SAT <span class="sc">+</span> verb_SAT, <span class="at">data =</span> gpa)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gpa<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = univ_GPA ~ high_GPA + math_SAT + verb_SAT, data = gpa)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.68186 -0.13189  0.01289  0.16186  0.93994 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.5793478  0.3422627   1.693   0.0936 .  
high_GPA    0.5454213  0.0850265   6.415  4.6e-09 ***
math_SAT    0.0004893  0.0010215   0.479   0.6330    
verb_SAT    0.0010202  0.0008123   1.256   0.2120    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2784 on 101 degrees of freedom
Multiple R-squared:  0.6236,    Adjusted R-squared:  0.6124 
F-statistic: 55.77 on 3 and 101 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" type="a">
<li>Test whether adding the two SAT scores has improved the prediction of university GPA. What do you conclude?</li>
</ol>
<p>Solution</p>
<p>Since we added <em>two</em> explanatory variables, the <span class="math inline">\(t\)</span>-tests in <code>gpa.2</code> don’t apply (they tell us whether we can take out <em>one</em> <span class="math inline">\(x\)</span>-variable). We might have some suspicions, but that’s all they are. So we have to do <code>anova</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(gpa<span class="fl">.1</span>, gpa<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Res.Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["RSS"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Sum of Sq"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["F"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Pr(>F)"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"103","2":"8.158723","3":"NA","4":"NA","5":"NA","6":"NA","_rn_":"1"},{"1":"101","2":"7.828840","3":"2","4":"0.329883","5":"2.127913","6":"0.1243939","_rn_":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>If you put the models the other way around, you’ll get a negative <span class="math inline">\(F\)</span>-statistic and degrees of freedom, which doesn’t make much sense (although the test will still work).</p>
<p>The null hypothesis here is that the two models fit equally well. Since the P-value is not small, we do not reject that null hypothesis, and therefore we conclude that the two models <em>do</em> fit equally well, and therefore we prefer the smaller one, the one that predicts university GPA from just high-school GPA. (Or, equivalently, we conclude that those two SAT scores don’t add anything to the prediction of how well a student will do at university, once you know their high-school GPA.)</p>
<p>This might surprise you, given what the SATs are supposed to be <em>for</em>. But that’s what the data say.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="8" type="a">
<li>Carry out a backward elimination starting out from your model in part (<a href="#part:all">here</a>). Which model do you end up with? Is it the same model as you fit in (<a href="#part:highonly">here</a>)?</li>
</ol>
<p>Solution</p>
<p>In the model of (<a href="#part:all">here</a>), <code>math_SAT</code> was the least significant, so that comes out first. (I use <code>update</code> but I’m not insisting that you do:)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>gpa<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">update</span>(gpa<span class="fl">.2</span>, . <span class="sc">~</span> . <span class="sc">-</span> math_SAT)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gpa<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = univ_GPA ~ high_GPA + verb_SAT, data = gpa)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.68430 -0.11268  0.01802  0.14901  0.95239 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.6838723  0.2626724   2.604   0.0106 *  
high_GPA    0.5628331  0.0765729   7.350 5.07e-11 ***
verb_SAT    0.0012654  0.0006283   2.014   0.0466 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2774 on 102 degrees of freedom
Multiple R-squared:  0.6227,    Adjusted R-squared:  0.6153 
F-statistic: 84.18 on 2 and 102 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Here is where we have to stop, since both high-school GPA and verbal SAT score are significant, and so taking either of them out would be a bad idea. This is a <em>different</em> model than the one of (<a href="#part:highonly">here</a>). This is the case, even though the model with high-school GPA only was not significantly worse than the model containing everything. (This goes to show that model-building doesn’t always have nice clear answers.)</p>
<p>In the model I called <code>gpa.2</code>, neither of the SAT scores were anywhere near significant (considered singly), but as soon as we took out one of the SAT scores (my model <code>gpa.3</code>), the other one became significant. This goes to show that you shouldn’t take out more than one explanatory variable based on the results of the <span class="math inline">\(t\)</span>-tests, and even if you test to see whether you should have taken out both of the SAT, you won’t necessarily get consistent results. Admittedly, it’s a close decision whether to keep or remove <code>verb_SAT</code>, since its P-value is close to 0.05.</p>
<p>The other way of tackling this one is via <code>step</code>, which does the backward elimination for you (not that it was much work here):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(gpa<span class="fl">.2</span>, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-264.6
univ_GPA ~ high_GPA + math_SAT + verb_SAT

           Df Sum of Sq     RSS     AIC F value    Pr(&gt;F)    
- math_SAT  1    0.0178  7.8466 -266.36  0.2294     0.633    
- verb_SAT  1    0.1223  7.9511 -264.97  1.5777     0.212    
&lt;none&gt;                   7.8288 -264.60                      
- high_GPA  1    3.1896 11.0184 -230.71 41.1486 4.601e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Step:  AIC=-266.36
univ_GPA ~ high_GPA + verb_SAT

           Df Sum of Sq     RSS     AIC F value    Pr(&gt;F)    
&lt;none&gt;                   7.8466 -266.36                      
- verb_SAT  1    0.3121  8.1587 -264.26  4.0571   0.04662 *  
- high_GPA  1    4.1562 12.0028 -223.73 54.0268 5.067e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = univ_GPA ~ high_GPA + verb_SAT, data = gpa)

Coefficients:
(Intercept)     high_GPA     verb_SAT  
   0.683872     0.562833     0.001265  </code></pre>
</div>
</div>
<p>This gives the same result as we did from our backward elimination. The tables with AIC in them are each step of the elimination, and the variable at the top is the one that comes out next. (When <code>&lt;none&gt;</code> gets to the top, that’s when you stop.) What happened is that the two SAT scores started off highest, but once we removed <code>math_SAT</code>, <code>verb_SAT</code> jumped below <code>&lt;none&gt;</code> and so the verbal SAT score had to stay.</p>
<p>Both the P-value and the AIC say that the decision about keeping or removing <code>verb_SAT</code> is very close.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol type="i">
<li>These students were studying computer science at university. Do you find your backward-elimination result sensible or surprising, given this? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>I would expect computer science students to be strong students generally, good at math and possibly not so good with words. So it is not surprising that high-school GPA figures into the prediction, but I would expect math SAT score to have an impact also, and it does not. It is also rather surprising that verbal SAT score predicts success at university for these computer science students; you wouldn’t think that having better skills with words would be helpful. So I’m surprised. Here, I’m looking for some kind of discussion about what’s in the final backward-elimination model, and what you would expect to be true of computer science students.</p>
<p>Let’s look at the final model from the backward elimination again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gpa<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = univ_GPA ~ high_GPA + verb_SAT, data = gpa)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.68430 -0.11268  0.01802  0.14901  0.95239 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.6838723  0.2626724   2.604   0.0106 *  
high_GPA    0.5628331  0.0765729   7.350 5.07e-11 ***
verb_SAT    0.0012654  0.0006283   2.014   0.0466 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2774 on 102 degrees of freedom
Multiple R-squared:  0.6227,    Adjusted R-squared:  0.6153 
F-statistic: 84.18 on 2 and 102 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The two slope estimates are both positive, meaning that, all else equal, a higher value for each explanatory variable goes with a higher university GPA. This indicates that a higher verbal SAT score goes with a higher university GPA: this is across all the university courses that a student takes, which you would expect to be math and computer science courses for a Comp Sci student, but might include a few electives or writing courses. Maybe what is happening is that the math SAT score is telling the same story as the high-school GPA for these students, and the verbal SAT score is saying something different. (For example, prospective computer science students are mostly likely to have high math SAT scores, so there’s not much information there.)</p>
<p>I think I need to look at the correlations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(gpa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          high_GPA  math_SAT  verb_SAT  comp_GPA  univ_GPA
high_GPA 1.0000000 0.7681423 0.7261478 0.7914721 0.7795631
math_SAT 0.7681423 1.0000000 0.8352272 0.6877209 0.6627837
verb_SAT 0.7261478 0.8352272 1.0000000 0.6387512 0.6503012
comp_GPA 0.7914721 0.6877209 0.6387512 1.0000000 0.9390459
univ_GPA 0.7795631 0.6627837 0.6503012 0.9390459 1.0000000</code></pre>
</div>
</div>
<p>We’ll ignore <code>comp_GPA</code> (i) because we haven’t been thinking about it and (ii) because it’s highly correlated with the university GPA anyway. (There isn’t a sense that one of the two university GPAs is explanatory and the other is a response, since students are taking the courses that contribute to them at the same time.)</p>
<p>The highest correlation with university GPA of what remains is high-school GPA, so it’s not at all surprising that this features in all our regressions. The correlations between university GPA and the two SAT scores are about equal, so there appears to be no reason to favour one of the SAT scores over the other. But, the two SAT scores are highly correlated with <em>each other</em> (0.835), which suggests that if you have one, you don’t need the other, because they are telling more or less the same story.</p>
<p>That makes me wonder how a regression with the SAT math score and <em>not</em> the SAT verbal score would look:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>gpa<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(univ_GPA <span class="sc">~</span> high_GPA <span class="sc">+</span> math_SAT, <span class="at">data =</span> gpa)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gpa<span class="fl">.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = univ_GPA ~ high_GPA + math_SAT, data = gpa)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.68079 -0.12264  0.00741  0.16579  0.90010 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.6072916  0.3425047   1.773   0.0792 .  
high_GPA    0.5710745  0.0827705   6.899  4.5e-10 ***
math_SAT    0.0012980  0.0007954   1.632   0.1058    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2792 on 102 degrees of freedom
Multiple R-squared:  0.6177,    Adjusted R-squared:  0.6102 
F-statistic:  82.4 on 2 and 102 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Math SAT does not quite significantly add anything to the prediction, which confirms that we do better to use the verbal SAT score (surprising though it seems). Though, the two regressions with the single SAT scores, <code>gpa.3</code> and <code>gpa.4</code>, have almost the same R-squared values. It’s not clear-cut at all. In the end, you have to make a call and stand by it.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</section>
<section id="fish-and-mercury-1" class="level2" data-number="19.9">
<h2 data-number="19.9" class="anchored" data-anchor-id="fish-and-mercury-1"><span class="header-section-number">19.9</span> Fish and mercury</h2>
<p>Eating fish is generally healthy, but sometimes the fish is contaminated with mercury. What might affect the amount of mercury in a fish? Large-mouth bass were studied in Florida lakes to examine factors that might affect the amount of mercury contamination. 38 lakes were used for the study. Water samples were taken from each lake and analyzed. Also, samples of fish were caught in each lake and the mercury concentration in their muscle tissue was measured. The resulting data are in <a href="http://ritsokiguess.site/datafiles/mercury.txt">http://ritsokiguess.site/datafiles/mercury.txt</a>, separated by single spaces. The variables measured were as follows:</p>
<ul>
<li>standardized mercury level (parts per million in 3-year-old fish)</li>
<li>alkalinity of water (milligrams per litre)</li>
<li>calcium level of water (milligrams per litre)</li>
<li>pH of water (standard scale; see eg. <a href="https://www.usgs.gov/special-topic/water-science-school/science/ph-and-water?qt-science_center_objects=0#qt-science_center_objects">this</a>)</li>
</ul>
<ol type="a">
<li>Read in and display (some of) the data.</li>
</ol>
<p>Solution</p>
<p>The data values were separated by single spaces, so this one is <code>read_delim</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/mercury.txt"</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>mercury <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(my_url, <span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 38 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
dbl (4): mercury, alkalinity, calcium, ph

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>mercury</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mercury"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["alkalinity"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["calcium"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ph"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1330","2":"2.5","3":"2.9","4":"4.6"},{"1":"250","2":"19.6","3":"4.5","4":"7.3"},{"1":"450","2":"5.2","3":"2.8","4":"5.4"},{"1":"160","2":"71.4","3":"55.2","4":"8.1"},{"1":"720","2":"26.4","3":"9.2","4":"5.8"},{"1":"810","2":"4.8","3":"4.6","4":"6.4"},{"1":"710","2":"6.6","3":"2.7","4":"5.4"},{"1":"510","2":"16.5","3":"13.8","4":"7.2"},{"1":"1000","2":"7.1","3":"5.2","4":"5.8"},{"1":"150","2":"83.7","3":"66.5","4":"8.2"},{"1":"190","2":"108.5","3":"35.6","4":"8.7"},{"1":"1020","2":"6.4","3":"4.0","4":"5.8"},{"1":"450","2":"7.5","3":"2.0","4":"4.4"},{"1":"590","2":"17.3","3":"10.7","4":"6.7"},{"1":"810","2":"7.0","3":"6.3","4":"6.9"},{"1":"420","2":"10.5","3":"6.3","4":"5.5"},{"1":"530","2":"30.0","3":"13.9","4":"6.9"},{"1":"310","2":"55.4","3":"15.9","4":"7.3"},{"1":"470","2":"6.3","3":"3.3","4":"5.8"},{"1":"250","2":"67.0","3":"58.6","4":"7.8"},{"1":"410","2":"28.8","3":"10.2","4":"7.4"},{"1":"160","2":"119.1","3":"38.4","4":"7.9"},{"1":"160","2":"25.4","3":"8.8","4":"7.1"},{"1":"230","2":"106.5","3":"90.7","4":"6.8"},{"1":"560","2":"8.5","3":"2.5","4":"7.0"},{"1":"890","2":"87.6","3":"85.5","4":"7.5"},{"1":"180","2":"114.0","3":"72.6","4":"7.0"},{"1":"190","2":"97.5","3":"45.5","4":"6.8"},{"1":"440","2":"11.8","3":"24.2","4":"5.9"},{"1":"160","2":"66.5","3":"26.0","4":"8.3"},{"1":"670","2":"16.0","3":"41.2","4":"6.7"},{"1":"550","2":"5.0","3":"23.6","4":"6.2"},{"1":"580","2":"25.6","3":"12.6","4":"6.2"},{"1":"980","2":"1.2","3":"2.1","4":"4.3"},{"1":"310","2":"34.0","3":"13.1","4":"7.0"},{"1":"430","2":"15.5","3":"5.2","4":"6.9"},{"1":"280","2":"17.3","3":"3.0","4":"5.2"},{"1":"250","2":"71.8","3":"20.5","4":"7.9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Extra: I found these data in a textbook, and I couldn’t find them online anywhere, so I typed them in myself. This is how I did it.</p>
<p>First, I entered the values as a piece of text:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>mercury_txt <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="st">mercury alkalinity calcium ph</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="st">1330 2.5 2.9 4.6</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="st">250 19.6 4.5 7.3</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="st">450 5.2 2.8 5.4</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="st">160 71.4 55.2 8.1</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="st">720 26.4 9.2 5.8</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="st">810 4.8 4.6 6.4</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="st">710 6.6 2.7 5.4</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="st">510 16.5 13.8 7.2</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="st">1000 7.1 5.2 5.8</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="st">150 83.7 66.5 8.2</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="st">190 108.5 35.6 8.7</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="st">1020 6.4 4.0 5.8</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="st">450 7.5 2.0 4.4</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="st">590 17.3 10.7 6.7</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="st">810 7.0 6.3 6.9</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="st">420 10.5 6.3 5.5</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a><span class="st">O530 30.0 13.9 6.9</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a><span class="st">310 55.4 15.9 7.3</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a><span class="st">470 6.3 3.3 5.8</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a><span class="st">250 67.0 58.6 7.8</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a><span class="st">410 28.8 10.2 7.4</span></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a><span class="st">160 119.1 38.4 7.9</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a><span class="st">160 25.4 8.8 7.1</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a><span class="st">230 106.5 90.7 6.8</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a><span class="st">560 8.5 2.5 7.0</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a><span class="st">890 87.6 85.5 7.5</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a><span class="st">180 114.0 72.6 7.0</span></span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a><span class="st">190 97.5 45.5 6.8</span></span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a><span class="st">440 11.8 24.2 5.9</span></span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a><span class="st">160 66.5 26.0 8.3</span></span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a><span class="st">670 16.0 41.2 6.7</span></span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a><span class="st">550 5.0 23.6 6.2</span></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a><span class="st">580 25.6 12.6 6.2</span></span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a><span class="st">980 1.2 2.1 4.3</span></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a><span class="st">310 34.0 13.1 7.0</span></span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a><span class="st">430 15.5 5.2 6.9</span></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a><span class="st">280 17.3 3.0 5.2</span></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a><span class="st">250 71.8 20.5 7.9</span></span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, I wanted to get these into a file laid out just like that, which is what <code>writeLines</code> does:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(mercury_txt, <span class="st">"mercury.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and then I uploaded the file to the course website.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" type="a">
<li>Plot the mercury levels against each of the explanatory variables.</li>
</ol>
<p>Solution</p>
<p>The best way to do this is in one shot, using facets. This means organizing the dataframe so that there is one column of <span class="math inline">\(y\)</span>-values, and also one column of <span class="math inline">\(x\)</span>-values, with an additional column labelling which <span class="math inline">\(x\)</span> it is. This, as you’ll recall, is exactly what <code>pivot_longer</code> does. To show you:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>mercury <span class="sc">%&gt;%</span> </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(<span class="sc">-</span>mercury, <span class="at">names_to =</span> <span class="st">"xname"</span>, <span class="at">values_to =</span> <span class="st">"xval"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mercury"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["xname"],"name":[2],"type":["chr"],"align":["left"]},{"label":["xval"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1330","2":"alkalinity","3":"2.5"},{"1":"1330","2":"calcium","3":"2.9"},{"1":"1330","2":"ph","3":"4.6"},{"1":"250","2":"alkalinity","3":"19.6"},{"1":"250","2":"calcium","3":"4.5"},{"1":"250","2":"ph","3":"7.3"},{"1":"450","2":"alkalinity","3":"5.2"},{"1":"450","2":"calcium","3":"2.8"},{"1":"450","2":"ph","3":"5.4"},{"1":"160","2":"alkalinity","3":"71.4"},{"1":"160","2":"calcium","3":"55.2"},{"1":"160","2":"ph","3":"8.1"},{"1":"720","2":"alkalinity","3":"26.4"},{"1":"720","2":"calcium","3":"9.2"},{"1":"720","2":"ph","3":"5.8"},{"1":"810","2":"alkalinity","3":"4.8"},{"1":"810","2":"calcium","3":"4.6"},{"1":"810","2":"ph","3":"6.4"},{"1":"710","2":"alkalinity","3":"6.6"},{"1":"710","2":"calcium","3":"2.7"},{"1":"710","2":"ph","3":"5.4"},{"1":"510","2":"alkalinity","3":"16.5"},{"1":"510","2":"calcium","3":"13.8"},{"1":"510","2":"ph","3":"7.2"},{"1":"1000","2":"alkalinity","3":"7.1"},{"1":"1000","2":"calcium","3":"5.2"},{"1":"1000","2":"ph","3":"5.8"},{"1":"150","2":"alkalinity","3":"83.7"},{"1":"150","2":"calcium","3":"66.5"},{"1":"150","2":"ph","3":"8.2"},{"1":"190","2":"alkalinity","3":"108.5"},{"1":"190","2":"calcium","3":"35.6"},{"1":"190","2":"ph","3":"8.7"},{"1":"1020","2":"alkalinity","3":"6.4"},{"1":"1020","2":"calcium","3":"4.0"},{"1":"1020","2":"ph","3":"5.8"},{"1":"450","2":"alkalinity","3":"7.5"},{"1":"450","2":"calcium","3":"2.0"},{"1":"450","2":"ph","3":"4.4"},{"1":"590","2":"alkalinity","3":"17.3"},{"1":"590","2":"calcium","3":"10.7"},{"1":"590","2":"ph","3":"6.7"},{"1":"810","2":"alkalinity","3":"7.0"},{"1":"810","2":"calcium","3":"6.3"},{"1":"810","2":"ph","3":"6.9"},{"1":"420","2":"alkalinity","3":"10.5"},{"1":"420","2":"calcium","3":"6.3"},{"1":"420","2":"ph","3":"5.5"},{"1":"530","2":"alkalinity","3":"30.0"},{"1":"530","2":"calcium","3":"13.9"},{"1":"530","2":"ph","3":"6.9"},{"1":"310","2":"alkalinity","3":"55.4"},{"1":"310","2":"calcium","3":"15.9"},{"1":"310","2":"ph","3":"7.3"},{"1":"470","2":"alkalinity","3":"6.3"},{"1":"470","2":"calcium","3":"3.3"},{"1":"470","2":"ph","3":"5.8"},{"1":"250","2":"alkalinity","3":"67.0"},{"1":"250","2":"calcium","3":"58.6"},{"1":"250","2":"ph","3":"7.8"},{"1":"410","2":"alkalinity","3":"28.8"},{"1":"410","2":"calcium","3":"10.2"},{"1":"410","2":"ph","3":"7.4"},{"1":"160","2":"alkalinity","3":"119.1"},{"1":"160","2":"calcium","3":"38.4"},{"1":"160","2":"ph","3":"7.9"},{"1":"160","2":"alkalinity","3":"25.4"},{"1":"160","2":"calcium","3":"8.8"},{"1":"160","2":"ph","3":"7.1"},{"1":"230","2":"alkalinity","3":"106.5"},{"1":"230","2":"calcium","3":"90.7"},{"1":"230","2":"ph","3":"6.8"},{"1":"560","2":"alkalinity","3":"8.5"},{"1":"560","2":"calcium","3":"2.5"},{"1":"560","2":"ph","3":"7.0"},{"1":"890","2":"alkalinity","3":"87.6"},{"1":"890","2":"calcium","3":"85.5"},{"1":"890","2":"ph","3":"7.5"},{"1":"180","2":"alkalinity","3":"114.0"},{"1":"180","2":"calcium","3":"72.6"},{"1":"180","2":"ph","3":"7.0"},{"1":"190","2":"alkalinity","3":"97.5"},{"1":"190","2":"calcium","3":"45.5"},{"1":"190","2":"ph","3":"6.8"},{"1":"440","2":"alkalinity","3":"11.8"},{"1":"440","2":"calcium","3":"24.2"},{"1":"440","2":"ph","3":"5.9"},{"1":"160","2":"alkalinity","3":"66.5"},{"1":"160","2":"calcium","3":"26.0"},{"1":"160","2":"ph","3":"8.3"},{"1":"670","2":"alkalinity","3":"16.0"},{"1":"670","2":"calcium","3":"41.2"},{"1":"670","2":"ph","3":"6.7"},{"1":"550","2":"alkalinity","3":"5.0"},{"1":"550","2":"calcium","3":"23.6"},{"1":"550","2":"ph","3":"6.2"},{"1":"580","2":"alkalinity","3":"25.6"},{"1":"580","2":"calcium","3":"12.6"},{"1":"580","2":"ph","3":"6.2"},{"1":"980","2":"alkalinity","3":"1.2"},{"1":"980","2":"calcium","3":"2.1"},{"1":"980","2":"ph","3":"4.3"},{"1":"310","2":"alkalinity","3":"34.0"},{"1":"310","2":"calcium","3":"13.1"},{"1":"310","2":"ph","3":"7.0"},{"1":"430","2":"alkalinity","3":"15.5"},{"1":"430","2":"calcium","3":"5.2"},{"1":"430","2":"ph","3":"6.9"},{"1":"280","2":"alkalinity","3":"17.3"},{"1":"280","2":"calcium","3":"3.0"},{"1":"280","2":"ph","3":"5.2"},{"1":"250","2":"alkalinity","3":"71.8"},{"1":"250","2":"calcium","3":"20.5"},{"1":"250","2":"ph","3":"7.9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>and now we plot <code>mercury</code> against <code>xval</code> in facets according to <code>xname</code>. The other thing to remember is that the explanatory variables are on different scales, so we should use <code>scales="free"</code> to allow each facet to have its own scales:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>mercury <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(<span class="sc">-</span>mercury, <span class="at">names_to =</span> <span class="st">"xname"</span>, <span class="at">values_to =</span> <span class="st">"xval"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xval, <span class="at">y =</span> mercury)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span>xname, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/hachel-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I did one more thing, which is to note that I am going to be assessing these relationships in a moment, so I would rather have squarer plots than the tall skinny ones that come out by default (that is to say these):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>mercury <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(<span class="sc">-</span>mercury, <span class="at">names_to =</span> <span class="st">"xname"</span>, <span class="at">values_to =</span> <span class="st">"xval"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xval, <span class="at">y =</span> mercury)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span>xname, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/endinger-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To make this happen, I added <code>ncol=2</code>, which says to arrange the facets in <em>two</em> columns (that is, as three cells of a <span class="math inline">\(2\times 2\)</span> grid), and that makes them come out more landscape than portrait. <code>nrow=2</code> would have had the same effect.</p>
<p>If you are stuck, get three separate graphs, but note that you are making more work for yourself (that you will have to do again later).</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" type="a">
<li>Describe any trends (or lack thereof) that you see on your graphs.</li>
</ol>
<p>Solution</p>
<p>Think about “form, direction, strength” to guide you in interpreting what you see: is it a line or a curve, does it go up or down, and are the points mostly close to the trend or not? I think it makes most sense to talk about those things for the three trends one after the other:</p>
<ul>
<li><code>alkalinity</code>: this is a curved trend, but downward (the rate of decrease is fast at the beginning and then levels off). There is one clear outlier, but otherwise most of the points are close to the trend.</li>
<li><code>calcium</code>: this is a down-and-up curved trend, though I think most of the evidence for the “up” part is the outlier on the middle right of the graph; without that, it would probably be a levelling-off decreasing trend as for <code>alkalinity</code>. There seem to be more outliers on this plot, and, on top of that, the points are not that close to the trend.</li>
<li><code>ph</code>: this is a downward trend, more or less linear, but of only moderate strength. The points can be some way from the trend, but (in contrast to the other plots) there don’t seem to be any points a <em>long</em> way away.</li>
</ul>
<p>If you are going to talk about outliers, you need to be specific about where they are: describe where they are on the plot, or give approximate coordinates (you only need to be accurate enough to make it clear which point you are talking about). For example, I described one of the outliers on the <code>calcium</code> plot as “middle right”, or you could describe the same point as having <code>calcium</code> above 80 and <code>mercury</code> near 1000, which narrows it down enough. There is a grey area between outliers and not being close to the trend overall; if it is a lot of points, I’d call it a weaker trend (as for <code>ph</code>), but if it’s a few points that are a long way off, as for <code>calcium</code>, I’d call that outliers.</p>
<p>Extra: most of the outliers are <em>above</em> the trends, which suggests that something to bring the high values down a bit would be helpful: that is, a transformation like log or square root. That’s coming up later.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" type="a">
<li>Concerned by some of what you see on your plots, you consult with a fisheries scientist, who says that using the logs of <code>alkalinity</code> and <code>calcium</code> are often used in modelling this kind of data. Add columns containing the logs of these two variables to your dataframe, and run a regression predicting <code>mercury</code> from <code>ph</code> and the two new variables. Display the output from your regression.</li>
</ol>
<p>Solution</p>
<p>I would create the two new variables and save them back into the original dataframe, myself:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>mercury <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">log_alkalinity =</span> <span class="fu">log</span>(alkalinity), <span class="at">log_calcium =</span> <span class="fu">log</span>(calcium)) <span class="ot">-&gt;</span> mercury</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>though you could equally well create a new dataframe to hold them, as long as you remember to use the new dataframe from here on.</p>
<p>The regression has no great surprises:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>mercury<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(mercury <span class="sc">~</span> log_alkalinity <span class="sc">+</span> log_calcium <span class="sc">+</span> ph, <span class="at">data =</span> mercury)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mercury<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mercury ~ log_alkalinity + log_calcium + ph, data = mercury)

Residuals:
    Min      1Q  Median      3Q     Max 
-326.02 -129.92  -27.67   71.17  581.76 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     1181.20     244.21   4.837 2.79e-05 ***
log_alkalinity  -221.18      58.87  -3.757 0.000646 ***
log_calcium       87.90      51.43   1.709 0.096520 .  
ph               -36.63      51.09  -0.717 0.478362    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 204.4 on 34 degrees of freedom
Multiple R-squared:  0.5578,    Adjusted R-squared:  0.5188 
F-statistic:  14.3 on 3 and 34 DF,  p-value: 3.424e-06</code></pre>
</div>
</div>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" type="a">
<li>What might you learn from running Box-Cox here? Explain briefly, then run it (on the same variables as your regression above) and describe what the results tell you.</li>
</ol>
<p>Solution</p>
<p>Box-Cox is to find out whether you need to transform the response variable, here <code>mercury</code>. The hint is that we have already transformed two of the explanatory variables, the ones that had some unusually large values, and so those are presumably now all right now.</p>
<p><code>boxcox</code> comes from the <code>MASS</code> package, so install and load that first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxcox</span>(mercury <span class="sc">~</span> log_alkalinity <span class="sc">+</span> log_calcium <span class="sc">+</span> ph, <span class="at">data =</span> mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/mercury-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The confidence interval for <span class="math inline">\(\lambda\)</span> goes from about <span class="math inline">\(-0.4\)</span> to <span class="math inline">\(0.5\)</span>. The only round-number powers in there are 0 (log) and 0.5 (square root, right on the end). The <span class="math inline">\(\lambda\)</span> for the log transformation is right in the middle of the interval, so that’s what I would choose. That means that we should use log of mercury instead of mercury itself in a regression.</p>
<p>Extra: I looked at the residual plots of the regression <code>mercury.1</code>, in the hope that they would point you towards some kind of transformation of <code>mercury</code>, but they really didn’t – the biggest feature was an upper-end outlier, more extreme than the one you see below, that appeared on all of them. So I didn’t have you produce those graphs.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="6" type="a">
<li>Using the results of the Box-Cox procedure and your previous work in the question, what seems to be the most appropriate regression now? Fit it, and display the results.</li>
</ol>
<p>Solution</p>
<p>This says to predict log-mercury (Box-Cox) from log-alkalinity, log-calcium (the fisheries scientist) and pH:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>mercury<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(mercury) <span class="sc">~</span> log_alkalinity <span class="sc">+</span> log_calcium <span class="sc">+</span> ph, <span class="at">data =</span> mercury)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mercury<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(mercury) ~ log_alkalinity + log_calcium + ph, 
    data = mercury)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.75244 -0.30191 -0.00783  0.23852  1.22932 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     7.55983    0.48981  15.434  &lt; 2e-16 ***
log_alkalinity -0.45880    0.11807  -3.886 0.000449 ***
log_calcium     0.14702    0.10315   1.425 0.163185    
ph             -0.07998    0.10248  -0.780 0.440527    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4099 on 34 degrees of freedom
Multiple R-squared:  0.6069,    Adjusted R-squared:  0.5723 
F-statistic:  17.5 on 3 and 34 DF,  p-value: 4.808e-07</code></pre>
</div>
</div>
<p>There’s no need to define a new column containing log-mercury in the dataframe, since you can define it in the <code>lm</code>. (Note for me: do I need to define new columns anywhere?)</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="7" type="a">
<li>Obtain all the standard residual plots (the ones we have seen in this course) for this model. Describe any problems you see.</li>
</ol>
<p>Solution</p>
<p>residuals against fitted</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mercury<span class="fl">.2</span>, <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>.resid)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/spaerwer-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>normal quantile plot of residuals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mercury<span class="fl">.2</span>, <span class="fu">aes</span>(<span class="at">sample =</span> .resid)) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/lugglinin-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>against the explanatory variables. This uses the ideas of <code>augment</code> (from <code>broom</code>) and pivoting longer:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>mercury<span class="fl">.2</span> <span class="sc">%&gt;%</span> <span class="fu">augment</span>(mercury) <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(ph<span class="sc">:</span>log_calcium, <span class="at">names_to =</span> <span class="st">"xname"</span>, <span class="at">values_to =</span> <span class="st">"xval"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> xval, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_wrap</span>(<span class="sc">~</span>xname, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/aertzinars-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I think the only troublesome feature on there is the large positive residual that appears at the top of all the plots. Other than that, I see nothing troubling.</p>
<p>You might, if you look a bit longer (but remember, apophenia!) see a tiny up and down on the plot with log-alkalinity, and maybe a small downward trend on the plots with the other two explanatory variables, but I would need a lot of convincing to say that these are more than chance. You are looking for <em>obvious trouble</em>, and I really don’t think there’s any sign of that here.</p>
<p>Extra: you sometimes see a downward trend on residual plots that have an outlier on them. This is because if you have an outlier, it can change the slope disproportionately from what it ought to be, and then most of the observations at one end will be underestimated and most of the observations at the other end will be overestimated.</p>
<p>Extra 2: which one was that outlier anyway?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>mercury<span class="fl">.2</span> <span class="sc">%&gt;%</span> <span class="fu">augment</span>(mercury) <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(.resid <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mercury"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["alkalinity"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["calcium"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ph"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["log_alkalinity"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["log_calcium"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".fitted"],"name":[7],"type":["dbl"],"align":["right"]},{"label":[".resid"],"name":[8],"type":["dbl"],"align":["right"]},{"label":[".hat"],"name":[9],"type":["dbl"],"align":["right"]},{"label":[".sigma"],"name":[10],"type":["dbl"],"align":["right"]},{"label":[".cooksd"],"name":[11],"type":["dbl"],"align":["right"]},{"label":[".std.resid"],"name":[12],"type":["dbl"],"align":["right"]}],"data":[{"1":"890","2":"87.6","3":"85.5","4":"7.5","5":"4.472781","6":"4.448516","7":"5.561902","8":"1.22932","9":"0.1106393","10":"0.3487183","11":"0.3145577","12":"3.180274"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>How do these compare to the other data values?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mercury)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mercury         alkalinity        calcium             ph       
 Min.   : 150.0   Min.   :  1.20   Min.   : 2.000   Min.   :4.300  
 1st Qu.: 250.0   1st Qu.:  7.20   1st Qu.: 4.525   1st Qu.:5.800  
 Median : 445.0   Median : 18.45   Median :11.650   Median :6.850  
 Mean   : 488.4   Mean   : 37.15   Mean   :22.361   Mean   :6.634  
 3rd Qu.: 650.0   3rd Qu.: 66.88   3rd Qu.:33.200   3rd Qu.:7.300  
 Max.   :1330.0   Max.   :119.10   Max.   :90.700   Max.   :8.700  
 log_alkalinity    log_calcium    
 Min.   :0.1823   Min.   :0.6931  
 1st Qu.:1.9738   1st Qu.:1.5096  
 Median :2.9131   Median :2.4520  
 Mean   :3.0193   Mean   :2.4801  
 3rd Qu.:4.2028   3rd Qu.:3.4938  
 Max.   :4.7800   Max.   :4.5076  </code></pre>
</div>
</div>
<p>The variable values are all high (even the pH, a modest-looking 7.5, is above Q3).</p>
<p>Remember that the fitted value is of <em>log</em>-mercury, so we have to anti-log it to understand it (anti-log is “exp” since these are “natural” or base-<span class="math inline">\(e\)</span> logs):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">5.561902</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 260.3175</code></pre>
</div>
</div>
<p>This was a <em>much</em> higher mercury value than expected, given the other variables.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
</section>
<section id="handling-shipments-of-chemicals-1" class="level2" data-number="19.10">
<h2 data-number="19.10" class="anchored" data-anchor-id="handling-shipments-of-chemicals-1"><span class="header-section-number">19.10</span> Handling shipments of chemicals</h2>
<p>The data in <a href="http://ritsokiguess.site/datafiles/chemical-drums.txt">link</a> are on shipments of chemicals in drums that arrive at a warehouse. In order, the variables are:</p>
<ul>
<li><p>the number of drums in the shipment</p></li>
<li><p>the total weight of the shipment, in hundreds of pounds.</p></li>
<li><p>the number of minutes required to handle the shipment (response).</p></li>
</ul>
<ol type="a">
<li>The data set has two features: <em>no</em> column names, and data aligned in columns (that is, more than one space between data values). Read the data in, giving the columns suitable names. To do this, you may have to consult an appropriate help file, or do some searching.</li>
</ol>
<p>Solution</p>
<p>The alignment of columns means that we need to use <code>read_table</code>. Once you’ve figured <em>that</em> out, you can search for help by typing <code>?read_table</code> in the Console window (the help will appear bottom right), or you can put the same thing into a code chunk, and when you run the chunk, the help will be displayed. (Press control-shift-1 to go back to the document.) Once you have figured out what to do, you want to delete this code chunk (if you created one), since this is for you, not your reader.</p>
<p>Or you can Google it, of course.</p>
<p>The key observation is that you need to supply some column names in <code>col_names</code>, like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>my_url <span class="ot">&lt;-</span> <span class="st">"http://ritsokiguess.site/datafiles/chemical-drums.txt"</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"drums"</span>, <span class="st">"weight"</span>, <span class="st">"minutes"</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>chemicals <span class="ot">&lt;-</span> <span class="fu">read_table</span>(my_url, <span class="at">col_names =</span> cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  drums = col_double(),
  weight = col_double(),
  minutes = col_double()
)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>chemicals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["drums"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["weight"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["minutes"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"7","2":"5.11","3":"58"},{"1":"18","2":"16.72","3":"152"},{"1":"5","2":"3.20","3":"41"},{"1":"14","2":"7.03","3":"93"},{"1":"11","2":"10.98","3":"101"},{"1":"5","2":"4.04","3":"38"},{"1":"23","2":"22.07","3":"203"},{"1":"9","2":"7.03","3":"78"},{"1":"16","2":"10.62","3":"117"},{"1":"5","2":"4.76","3":"44"},{"1":"17","2":"11.02","3":"121"},{"1":"12","2":"9.51","3":"112"},{"1":"6","2":"3.79","3":"50"},{"1":"12","2":"6.45","3":"82"},{"1":"8","2":"4.60","3":"48"},{"1":"15","2":"13.86","3":"127"},{"1":"17","2":"13.03","3":"140"},{"1":"21","2":"15.21","3":"155"},{"1":"6","2":"3.64","3":"39"},{"1":"11","2":"9.57","3":"90"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>I like to define my URL and column names up front. You can define either of them in the <code>read_table</code>, but it makes that line longer. Up to you.</p>
<p>There is no <code>skip</code> here, because the data file starts right away with the data and we want to use all the values: we are <em>adding</em> names to what’s in the data file. If you used <code>skip</code>, you will be one observation short all the way through, and your output will be slightly different from mine all the way through.</p>
<p>Use any names you like, but they should resemble what the columns actually represent.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="2" type="a">
<li>Fit a regression predicting the number of minutes required to handle a shipment from the other two variables. Display the results.</li>
</ol>
<p>Solution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>minutes<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(minutes <span class="sc">~</span> drums <span class="sc">+</span> weight, <span class="at">data =</span> chemicals)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(minutes<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = minutes ~ drums + weight, data = chemicals)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.8353 -3.5591 -0.0533  2.4018 15.1515 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   3.3243     3.1108   1.069      0.3    
drums         3.7681     0.6142   6.135 1.10e-05 ***
weight        5.0796     0.6655   7.632 6.89e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.618 on 17 degrees of freedom
Multiple R-squared:  0.9869,    Adjusted R-squared:  0.9854 
F-statistic: 641.6 on 2 and 17 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="3" type="a">
<li>Explain carefully but briefly what the slope coefficients for the two explanatory variables represent. Do their signs (positive or negative) make practical sense in the context of handling shipments of chemicals?</li>
</ol>
<p>Solution</p>
<p>The slope coefficient for <code>drums</code> is 3.77; this means that a shipment with one extra drum (but the same total weight) would take on average 3.77 minutes longer to handle. Likewise, the slope coefficient for <code>weight</code> is 5.08, so a shipment that weighs 1 hundred more pounds but has the same number of drums will take 5.08 more minutes to handle. Or “each additional drum, all else equal, will take 3.77 more minutes to handle”, or similar wording.</p>
<p>You have to get at two things: a one-unit increase in the explanatory variable going with a certain increase in the response, and <em>also</em> the “all else equal” part. How you say it is up to you, but you need to say it.</p>
<p>That was two marks. The third one comes from noting that both slope coefficients are positive, so making a shipment either contain more drums or weigh more makes the handling time longer as well. This makes perfect sense, since either kind of increase would make the shipment more difficult to handle, and thus take longer.</p>
<p>I was <em>not</em> asking about P-values. There isn’t really much to say about those: they’re both significant, so the handling time depends on both the total weight and the number of drums. Removing either from the regression would be a mistake.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="4" type="a">
<li>Obtain plots of residuals against fitted values, residuals against explanatory variables, and a normal quantile plot of the residuals.</li>
</ol>
<p>Solution</p>
<p>These are the standard plots from a multiple regression. The second one requires care, but the first and last should be straightforward. Residuals against fitted values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(minutes<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The tricky part about the second one is that the <span class="math inline">\(x\)</span>-values and the residuals come from different data frames, which has to get expressed in the <code>ggplot</code>. The obvious way is to do the two plots (one for each explanatory variable) one at a time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(minutes<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x =</span> chemicals<span class="sc">$</span>drums, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>and</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(minutes<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">x =</span> chemicals<span class="sc">$</span>weight, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What would also work is to make a data frame first with the things to plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight =</span> chemicals<span class="sc">$</span>weight, <span class="at">drums =</span> chemicals<span class="sc">$</span>drums, <span class="at">res =</span> <span class="fu">resid</span>(minutes<span class="fl">.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and then:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dd, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> res)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>and similarly for <code>drums</code>. The <code>resid</code> with the model name in brackets seems to be necessary.</p>
<p>Another way to approach this is <code>augment</code> from <code>broom</code>. That does this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> minutes<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">augment</span>(chemicals)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["drums"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["weight"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["minutes"],"name":[3],"type":["dbl"],"align":["right"]},{"label":[".fitted"],"name":[4],"type":["dbl"],"align":["right"]},{"label":[".resid"],"name":[5],"type":["dbl"],"align":["right"]},{"label":[".hat"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".sigma"],"name":[7],"type":["dbl"],"align":["right"]},{"label":[".cooksd"],"name":[8],"type":["dbl"],"align":["right"]},{"label":[".std.resid"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"7","2":"5.11","3":"58","4":"55.65775","5":"2.3422471","6":"0.09133349","7":"5.757770","8":"0.0064101777","9":"0.4374042"},{"1":"18","2":"16.72","3":"152","4":"156.08097","5":"-4.0809706","6":"0.19376540","7":"5.677870","8":"0.0524401531","9":"-0.8090683"},{"1":"5","2":"3.20","3":"41","4":"38.41952","5":"2.5804787","6":"0.13099986","7":"5.748943","8":"0.0122015599","9":"0.4927684"},{"1":"14","2":"7.03","3":"93","4":"91.78733","5":"1.2126695","6":"0.26847934","7":"5.779587","8":"0.0077933871","9":"0.2523955"},{"1":"11","2":"10.98","3":"101","4":"100.54737","5":"0.4526301","6":"0.14900387","7":"5.789147","8":"0.0004452592","9":"0.0873438"},{"1":"5","2":"4.04","3":"38","4":"42.68637","5":"-4.6863746","6":"0.14056367","7":"5.650853","8":"0.0441472158","9":"-0.8998758"},{"1":"23","2":"22.07","3":"203","4":"202.09731","5":"0.9026878","6":"0.42868587","7":"5.782744","8":"0.0113044124","9":"0.2125947"},{"1":"9","2":"7.03","3":"78","4":"72.94678","5":"5.0532196","6":"0.06651639","7":"5.640887","8":"0.0205890007","9":"0.9310377"},{"1":"16","2":"10.62","3":"117","4":"117.55927","5":"-0.5592686","6":"0.13453992","7":"5.788495","8":"0.0005934465","9":"-0.1070162"},{"1":"5","2":"4.76","3":"44","4":"46.34368","5":"-2.3436774","6":"0.16452717","7":"5.754855","8":"0.0136757853","9":"-0.4564404"},{"1":"17","2":"11.02","3":"121","4":"123.35921","5":"-2.3592135","6":"0.17857817","7":"5.753761","8":"0.0155601581","9":"-0.4633792"},{"1":"12","2":"9.51","3":"112","4":"96.84849","5":"15.1515133","6":"0.05138802","7":"4.289987","8":"0.1384778737","9":"2.7692627"},{"1":"6","2":"3.79","3":"50","4":"45.18459","5":"4.8154122","6":"0.11031467","7":"5.648035","8":"0.0341358732","9":"0.9087987"},{"1":"12","2":"6.45","3":"82","4":"81.30495","5":"0.6950502","6":"0.15597401","7":"5.787356","8":"0.0011172659","9":"0.1346761"},{"1":"8","2":"4.60","3":"48","4":"56.83527","5":"-8.8352734","6":"0.09537424","7":"5.304339","8":"0.0960985497","9":"-1.6536286"},{"1":"15","2":"13.86","3":"127","4":"130.24902","5":"-3.2490211","6":"0.12815463","7":"5.724729","8":"0.0187994039","9":"-0.6194200"},{"1":"17","2":"13.03","3":"140","4":"133.56918","5":"6.4308162","6":"0.09698045","7":"5.537776","8":"0.0519524153","9":"1.2046752"},{"1":"21","2":"15.21","3":"155","4":"159.71512","5":"-4.7151240","6":"0.23049569","7":"5.632364","8":"0.0914135514","9":"-0.9568416"},{"1":"6","2":"3.64","3":"39","4":"44.42265","5":"-5.4226497","6":"0.11180602","7":"5.608930","8":"0.0440206341","9":"-1.0242597"},{"1":"11","2":"9.57","3":"90","4":"93.38515","5":"-3.3851519","6":"0.07251911","7":"5.723379","8":"0.0102042828","9":"-0.6257173"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>and then you can use <code>d</code> as the “base” data frame from which everything comes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> drums, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>and</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>or you can even do that trick to put the two plots on facets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(drums<span class="sc">:</span>weight, <span class="at">names_to=</span><span class="st">"xname"</span>, <span class="at">values_to=</span><span class="st">"x"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> .resid)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>xname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Last, the normal quantile plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(minutes<span class="fl">.1</span>, <span class="fu">aes</span>(<span class="at">sample =</span> .resid)) <span class="sc">+</span> <span class="fu">stat_qq</span>() <span class="sc">+</span> <span class="fu">stat_qq_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As a check for the grader, there should be four plots, obtained somehow: residuals against fitted values, normal quantile plot of residuals, residuals against <code>drums</code>, residuals against<br>
<code>weight</code>.</p>
<p><span class="math inline">\(\blacksquare\)</span></p>
<ol start="5" type="a">
<li>Do you have any concerns, looking at the residual plots? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>The (only) concern I have, looking at those four plots, is the one very positive residual, the one around 15. Take that away, and I think all of the plots are then acceptable. Alternatively, I will take something like “I have no concerns about the form of the relationship”, saying that the <em>kind</em> of model being fitted here is OK (no evidence of non-linearity, fanning out, that kind of stuff). It’s up to you to decide whether you think “concerns” extends to outliers, high-influence points, etc.</p>
<p>The normal quantile plot reveals that the most negative residual, the one around <span class="math inline">\(-9\)</span>, is in fact almost exactly as negative as you would expect the most negative residual to be, so it is not an outlier at all. The residuals are almost exactly normally distributed, <em>except</em> for the most positive one.</p>
<p>I don’t think you can justify fanning-in, since the evidence for that is mostly from the single point on the right. The other points do not really have residuals closer to zero as you move left to right.</p>
<p>Do <em>not</em> be tempted to pick out everything you can think of wrong with these plots. The grader can, and will, take away points if you start naming things that are not concerns.</p>
<p>Extra: what else can I find out about that large-positive-residual point? This is where having the “augmented” data frame is a plus:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.resid <span class="sc">&gt;</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["drums"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["weight"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["minutes"],"name":[3],"type":["dbl"],"align":["right"]},{"label":[".fitted"],"name":[4],"type":["dbl"],"align":["right"]},{"label":[".resid"],"name":[5],"type":["dbl"],"align":["right"]},{"label":[".hat"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".sigma"],"name":[7],"type":["dbl"],"align":["right"]},{"label":[".cooksd"],"name":[8],"type":["dbl"],"align":["right"]},{"label":[".std.resid"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"12","2":"9.51","3":"112","4":"96.84849","5":"15.15151","6":"0.05138802","7":"4.289987","8":"0.1384779","9":"2.769263"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>As shown. The predicted number of minutes is 96.8, but the actual number of minutes it took is 112. Hence the residual of 15.2. Can we find “similar” numbers of <code>drums</code> and <code>weight</code> and compare the <code>minutes</code>? Try this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>chemicals <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">between</span>(weight, <span class="dv">8</span>, <span class="dv">11</span>),</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">between</span>(drums, <span class="dv">10</span>, <span class="dv">14</span>)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["drums"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["weight"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["minutes"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"11","2":"10.98","3":"101"},{"1":"12","2":"9.51","3":"112"},{"1":"11","2":"9.57","3":"90"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>You might not have seen <code>between</code> before, but it works the way you’d expect.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> Two other shipments with similar numbers of drums and total weight took around 90–100 minutes to handle, so the 112 does look about 15 minutes too long. This was actually an average-sized shipment:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">my_label =</span> <span class="fu">ifelse</span>(.resid <span class="sc">&gt;</span> <span class="dv">10</span>, <span class="st">"residual +"</span>, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> drums, <span class="at">y =</span> weight, <span class="at">colour =</span> minutes, <span class="at">label =</span> my_label)) <span class="sc">+</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_text_repel</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>so it’s a bit of a mystery why it took so long to handle.</p>
<p>I had some fun with the graph: if you set <code>colour</code> equal to a continuous variable (as <code>minutes</code> is here), you get a continuous colour scale, by default from dark blue (small) to light blue (large). The number of minutes tends to get larger (lighter) as you go up and to the right with bigger shipments. The point labelled “residual +” is the one with the large residual; it is a noticeably lighter blue than the points around it, meaning that it took longer to handle than those points. I used the trick from C32 to label “some” (here one) of the points: create a new label variable with a <code>mutate</code> and an <code>ifelse</code>, leaving all of the other labels blank so you don’t see them.</p>
<p>The blue colour scheme is a little hard to judge values on. Here’s another way to do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">my_label =</span> <span class="fu">ifelse</span>(.resid <span class="sc">&gt;</span> <span class="dv">10</span>, <span class="st">"residual +"</span>, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> drums, <span class="at">y =</span> weight, <span class="at">colour =</span> minutes, <span class="at">label =</span> my_label)) <span class="sc">+</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_text_repel</span>() <span class="sc">+</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient</span>(<span class="at">low =</span> <span class="st">"red"</span>, <span class="at">high =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multiple-regression_files/figure-html/chemical-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The labelled point is a little more blue (purplish) than the more clearly red points near it.</p>
<p>The other thing to see is that there is also a positive correlation between the number of drums and the total weight, which is what you’d expect. Unlike with some of our other examples, this wasn’t strong enough to cause problems; the separate effects of <code>drums</code> and <code>weight</code> on <code>minutes</code> were distinguishable enough to allow both explanatory variables to have a strongly significant effect on <code>minutes</code>.</p>
<p>Post scriptum: the “drums” here are not concert-band-type drums, but something like this:</p>
<p><img src="Chemical-Drums-200x200.png" class="img-fluid"></p>
<p><span class="math inline">\(\blacksquare\)</span></p>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>If there are more than one, they should be separated by plus signs as in <code>lm</code>. Each facet then has as many labels as variables. I haven’t actually done this myself, but from looking at examples, I think this is the way it works.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>If you don’t give it, you get the five-number summary.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This is because we used <span class="math inline">\(\alpha = 0.10\)</span>. <code>step</code> tends to keep explanatory variables that you might consider marginal because it uses AIC (see below) rather than P-values directly.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>This is “F” in quotes, meaning <span class="math inline">\(F\)</span>-test, not <code>F</code> without quotes, which is short for FALSE.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Adjusted R-squareds are easier to compare in this context, since you don’t have to make a judgement about whether it has changed substantially, whatever you think substantially means.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>The residuals have to be the ones from a regression <em>not</em> including the <span class="math inline">\(x\)</span>-variable you’re testing.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Or not take it out in the first place.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>Weight between 8 and 11, for example, returning <code>TRUE</code> or <code>FALSE</code>.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./simple-regression.html" class="pagination-link" aria-label="Simple regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Simple regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./regression-categorical.html" class="pagination-link" aria-label="Regression with categorical variables">
        <span class="nav-page-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Regression with categorical variables</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>